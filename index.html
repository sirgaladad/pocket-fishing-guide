<!DOCTYPE html>
<html lang="en">
<head>
<!-- Streamlined deployment workflow - Updated 2026-02-14 -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Fishing Intelligence | Tale Waters & Tides</title>
<meta name="description" content="Live white bass & crappie fishing intelligence for 9 major Arkansas lakes and rivers — Greers Ferry, Bull Shoals, Beaver, Ouachita, Maumelle, DeGray, Conway, White River, Buffalo River. Real-time USGS water data and NWS forecasts.">
<meta name="theme-color" content="#0d1b2a">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-929WWD4EZ4"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-929WWD4EZ4');
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#0d1b2a;--bg2:#1b2838;--bg3:#243447;--bg4:#2d3f52;
  --accent:#00bcd4;--accent-dk:#0097a7;--accent-lt:#4dd0e1;
  --text:#e0e6ed;--text2:#8899aa;--text3:#5a6a7a;
  --green:#4caf50;--orange:#ff9800;--red:#f44336;--blue:#2196f3;
  --spawn:#ff6b35;--yellow:#ffd54f;
  --radius:12px;--radius-sm:8px;
}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased}
#root{max-width:480px;margin:0 auto;min-height:100vh;position:relative}

/* ─── HEADER ─── */
.header{background:linear-gradient(135deg,#0d2137 0%,#0a3d5c 50%,#0d4a5e 100%);padding:16px 16px 0;text-align:center;position:sticky;top:0;z-index:100}
.header .brand{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--accent);opacity:.8;margin-bottom:2px}
.header h1{font-size:20px;font-weight:800;color:#fff;letter-spacing:-0.5px}
.header h1 span{color:var(--accent)}
.header-sub{font-size:11px;color:var(--text2);margin-top:2px}
.header-meta{font-size:10px;color:var(--text3);margin-top:2px;line-height:1.4}
.water-sel{display:flex;gap:6px;margin-top:10px;justify-content:center;flex-wrap:wrap}
.water-btn{background:var(--bg3);border:1.5px solid transparent;color:var(--text2);font-size:11px;font-weight:600;padding:6px 12px;border-radius:20px;cursor:pointer;transition:all .2s;font-family:inherit}
.water-btn.active{background:rgba(0,188,212,.15);border-color:var(--accent);color:var(--accent)}

/* ─── SPECIES TOGGLE ─── */
.species-toggle{display:flex;gap:4px;margin-top:6px;justify-content:center}
.species-btn{background:var(--bg3);border:1.5px solid transparent;color:var(--text3);font-size:10px;font-weight:700;padding:4px 10px;border-radius:14px;cursor:pointer;transition:all .2s;font-family:inherit;text-transform:uppercase;letter-spacing:.5px}
.species-btn.active-wb{background:rgba(255,107,53,.12);border-color:var(--spawn);color:var(--spawn)}
.species-btn.active-cr{background:rgba(156,39,176,.12);border-color:#ab47bc;color:#ab47bc}

/* ─── PHASE BANNER ─── */
.phase-banner{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,.25);border-radius:var(--radius-sm);padding:10px 14px;margin:10px 0 0;text-align:left}
.phase-banner-icon{font-size:28px;flex-shrink:0}
.phase-banner-text{flex:1}
.phase-banner-name{font-size:14px;font-weight:700}
.phase-banner-detail{font-size:11px;color:var(--text2);margin-top:1px}

/* ─── TABS (sticky below header) ─── */
.tabs{display:flex;background:var(--bg2);border-bottom:1px solid var(--bg3);position:sticky;top:0;z-index:99}
.tab{flex:1;padding:10px 4px 8px;text-align:center;cursor:pointer;transition:all .2s;border-bottom:2px solid transparent}
.tab.active{border-bottom-color:var(--accent)}
.tab-icon{font-size:16px;display:block;margin-bottom:2px}
.tab-label{font-size:10px;font-weight:600;color:var(--text3);letter-spacing:.5px;text-transform:uppercase}
.tab.active .tab-label{color:var(--accent)}

/* ─── CONTENT ─── */
.content{padding:12px;padding-bottom:20px}

/* ─── CARDS ─── */
.card{background:var(--bg2);border-radius:var(--radius);padding:16px;margin-bottom:12px;border:1px solid rgba(255,255,255,.04)}
.card-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text2);margin-bottom:10px}

/* ─── DASHBOARD 2-COL GRID ─── */
.dash-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
.dash-grid .card{margin-bottom:0}

/* ─── WATER TEMP CARD ─── */
.big-temp{font-size:44px;font-weight:800;color:#fff;line-height:1}
.big-temp .unit{font-size:18px;color:var(--text2);font-weight:600}
.temp-c{font-size:12px;color:var(--text3);margin-top:2px}
.temp-source-badge{display:inline-block;margin-left:8px;padding:2px 7px;border-radius:10px;font-size:9px;letter-spacing:.3px;background:rgba(255,255,255,.08);color:var(--text2);border:1px solid rgba(255,255,255,.1);vertical-align:middle}
.temp-source-note{font-size:10px;color:var(--text3);margin-top:6px;line-height:1.4}
.temp-empty{font-size:12px;color:var(--text2);line-height:1.5;margin-top:2px}
.trend{display:inline-flex;align-items:center;gap:3px;font-size:12px;font-weight:600;margin-top:6px}
.trend.up{color:var(--green)}
.trend.down{color:var(--blue)}
.trend.flat{color:var(--text2)}
.trend-row{display:flex;gap:16px;margin-top:4px}
.gauge-meta{font-size:9px;color:var(--text3);margin-top:8px;line-height:1.4}

/* ─── SPAWN PHASE CARD ─── */
.phase-icon{font-size:32px;margin-bottom:6px}
.phase-name{font-size:16px;font-weight:800;margin-bottom:4px}
.phase-dots{display:flex;gap:6px;margin-bottom:8px}
.phase-dot{width:20px;height:6px;border-radius:3px;background:var(--bg3)}
.phase-dot.active{background:var(--accent)}
.phase-desc{font-size:12px;color:var(--text2);line-height:1.4;margin-bottom:8px}
.phase-countdown{background:rgba(255,255,255,.05);border-radius:var(--radius-sm);padding:8px 10px;font-size:12px;color:var(--text2);line-height:1.5}
.phase-countdown span{color:var(--spawn);font-weight:700}

/* ─── SPAWN TRACKER ─── */
.spawn-bar{position:relative;height:10px;background:linear-gradient(90deg,#2196f3 0%,#4fc3f7 20%,#29b6f6 35%,#ff6b35 50%,#f44336 65%,#66bb6a 80%,#ffd54f 100%);border-radius:5px;margin:8px 0;overflow:visible}
.spawn-marker{position:absolute;top:-7px;width:20px;height:24px;background:#fff;border-radius:10px;transform:translateX(-50%);box-shadow:0 0 8px rgba(255,255,255,.5);z-index:2}
.spawn-labels{display:flex;justify-content:space-between;font-size:10px;color:var(--text3);padding:0 2px;margin-bottom:4px}
.spawn-milestones{display:flex;justify-content:space-around;margin-top:8px}
.spawn-ms{text-align:center}
.spawn-ms-label{font-size:12px;font-weight:700}
.spawn-ms-dist{font-size:10px;color:var(--text3);margin-top:1px}

/* ─── TEMP CHART ─── */
.temp-chart{display:flex;align-items:flex-end;gap:4px;height:120px;margin:8px 0}
.temp-bar-wrap{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;height:100%}
.temp-bar-area{flex:1;width:100%;display:flex;align-items:flex-end;min-height:0}
.temp-bar{width:100%;border-radius:4px 4px 0 0;min-height:6px;transition:height .5s ease}
.temp-bar-label{font-size:9px;color:var(--text3);flex-shrink:0}
.temp-bar-val{font-size:10px;font-weight:600;color:var(--text2);flex-shrink:0}
.trend-analysis{background:rgba(76,175,80,.1);border-radius:var(--radius-sm);padding:8px 12px;margin-top:10px;font-size:12px;color:var(--green);line-height:1.4}
.trend-analysis.cooling{background:rgba(33,150,243,.1);color:var(--blue)}

/* ─── QUICK GLANCE HERO ─── */
.hero-card{background:linear-gradient(135deg,#0d2137 0%,#0a3d5c 50%,#0d4a5e 100%);border-radius:var(--radius);padding:16px;margin-bottom:12px;border:1px solid rgba(0,188,212,.15);position:relative;overflow:hidden}
.hero-card::after{content:'';position:absolute;top:0;right:0;width:120px;height:120px;background:radial-gradient(circle,rgba(0,188,212,.08) 0%,transparent 70%);pointer-events:none}
.hero-verdict{display:flex;align-items:center;gap:10px;margin-bottom:10px}
.hero-signal{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;animation:pulse-signal 2s ease infinite}
.hero-signal.go{background:rgba(76,175,80,.2);box-shadow:0 0 12px rgba(76,175,80,.3)}
.hero-signal.scout{background:rgba(255,152,0,.2);box-shadow:0 0 12px rgba(255,152,0,.3)}
.hero-signal.wait{background:rgba(33,150,243,.2);box-shadow:0 0 12px rgba(33,150,243,.3)}
@keyframes pulse-signal{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
.hero-headline{font-size:16px;font-weight:800;color:#fff;line-height:1.3}
.hero-headline .hero-hl{color:var(--accent)}
.hero-summary{font-size:12px;color:var(--text2);line-height:1.5;margin-bottom:10px}
.hero-pills{display:flex;gap:6px;flex-wrap:wrap}
.hero-pill{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:4px 10px;font-size:11px;color:var(--text2);display:flex;align-items:center;gap:4px}
.hero-pill .pill-val{color:#fff;font-weight:700}

/* ─── SHARE SNAPSHOT ─── */
.share-btn{display:flex;align-items:center;justify-content:center;gap:6px;width:100%;background:rgba(0,188,212,.1);border:1px solid rgba(0,188,212,.25);color:var(--accent);font-size:12px;font-weight:700;padding:10px;border-radius:var(--radius-sm);cursor:pointer;font-family:inherit;transition:all .2s;margin-top:12px}
.share-btn:active{background:rgba(0,188,212,.2)}
.share-toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--accent);color:#000;padding:10px 20px;border-radius:20px;font-size:13px;font-weight:700;z-index:999;animation:toastIn .3s ease}

/* ─── WEATHER CARDS ─── */
.wx-cards{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
.wx-card{background:var(--bg3);border-radius:var(--radius-sm);padding:8px;text-align:center}
.wx-card .day{font-size:10px;color:var(--text2);font-weight:600;margin-bottom:4px}
.wx-card .icon{font-size:24px;margin-bottom:2px}
.wx-card .hi{font-size:16px;font-weight:700;color:#fff}
.wx-card .wind{font-size:9px;color:var(--text3);margin-top:2px}
.wx-card .desc{font-size:9px;color:var(--text2);margin-top:2px;line-height:1.2}

/* ─── FORECAST TABLE ─── */
.fc-row{display:flex;align-items:center;padding:10px 0;border-bottom:1px solid var(--bg3);gap:8px}
.fc-row:last-child{border:none}
.fc-icon{font-size:20px;width:28px;text-align:center;flex-shrink:0}
.fc-day{width:70px;font-size:13px;font-weight:600;flex-shrink:0}
.fc-temp{font-size:16px;font-weight:700;color:var(--spawn);width:42px;flex-shrink:0}
.fc-detail{flex:1;min-width:0}
.fc-desc{font-size:11px;color:var(--text2)}
.fc-wind{font-size:10px;color:var(--text3)}
.fc-daynight{font-size:18px;width:28px;text-align:center;flex-shrink:0}

/* ─── FISHING WINDOW ─── */
.fw-card{background:var(--bg3);border-radius:var(--radius-sm);padding:12px;margin-bottom:8px;border-left:3px solid var(--bg4)}
.fw-card.best{border-left-color:var(--green);background:rgba(76,175,80,.08)}
.fw-card.good{border-left-color:var(--blue);background:rgba(33,150,243,.08)}
.fw-card.note{border-left-color:var(--orange);background:rgba(255,152,0,.08)}
.fw-card.tip{border-left-color:var(--accent);background:rgba(0,188,212,.08)}
.fw-card-title{font-size:13px;font-weight:700;margin-bottom:4px}
.fw-card-body{font-size:12px;color:var(--text2);line-height:1.5}

/* ─── INTEL: PATTERN CARD ─── */
.pattern-card{background:linear-gradient(135deg,var(--bg3),var(--bg2));border:1px solid var(--accent);border-radius:var(--radius);padding:16px;margin-bottom:12px;position:relative;overflow:hidden}
.pattern-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:var(--accent)}
.here-badge{background:var(--accent);color:#000;font-size:10px;font-weight:800;padding:3px 8px;border-radius:10px;display:inline-block;margin-bottom:8px;float:right}
.pattern-name{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--accent);margin-bottom:4px}
.pattern-title{font-size:18px;font-weight:800;color:#fff;margin-bottom:8px}
.pattern-desc{font-size:13px;color:var(--text2);line-height:1.6}
.pattern-cols{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
.pattern-col{background:rgba(255,255,255,.04);border:1px dashed var(--bg4);border-radius:var(--radius-sm);padding:10px}
.pattern-col-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--spawn);margin-bottom:6px}
.pattern-col p{font-size:12px;color:var(--text2);line-height:1.5}

/* ─── LURE CARDS ─── */
.lure-card{display:flex;gap:12px;padding:12px;background:var(--bg3);border-radius:var(--radius-sm);margin-bottom:8px;align-items:center}
.lure-num{width:28px;height:28px;background:var(--accent);color:#000;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:13px;flex-shrink:0}
.lure-num.n1{background:var(--spawn)}
.lure-num.n2{background:var(--accent)}
.lure-num.n3{background:var(--blue)}
.lure-info h4{font-size:13px;font-weight:700;color:#fff;margin-bottom:1px}
.lure-info .lure-sub{font-size:11px;color:var(--accent);margin-bottom:2px}
.lure-info p{font-size:11px;color:var(--text2);line-height:1.3}

/* ─── CALENDAR ─── */
.calendar{margin:12px 0}
.cal-phase{background:var(--bg3);border-radius:var(--radius-sm);padding:12px;margin-bottom:8px;border-left:3px solid var(--bg4)}
.cal-phase-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}
.cal-phase-name{font-size:14px;font-weight:700;color:#fff}
.cal-phase-time{font-size:11px;color:var(--text3)}
.cal-phase-now{background:var(--accent);color:#000;font-size:9px;font-weight:800;padding:2px 6px;border-radius:8px;margin-left:6px}
.cal-phase-desc{font-size:12px;color:var(--text2);line-height:1.5;margin-bottom:6px}
.cal-phase-meta{font-size:11px;color:var(--text3);line-height:1.4}

/* ─── ACCESS ─── */
.access-alert{background:rgba(255,152,0,.1);border:1px solid rgba(255,152,0,.3);border-radius:var(--radius-sm);padding:12px;margin-bottom:12px;font-size:12px;color:var(--orange);line-height:1.5}
.access-point{padding:14px;background:var(--bg3);border-radius:var(--radius-sm);margin-bottom:10px}
.access-header{display:flex;align-items:center;gap:8px;margin-bottom:6px;flex-wrap:wrap}
.access-name{font-size:15px;font-weight:700;color:#fff}
.access-badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:10px;font-weight:700}
.access-badge.boat{background:rgba(33,150,243,.2);color:var(--blue)}
.access-badge.open{background:rgba(76,175,80,.2);color:var(--green)}
.access-badge.limited{background:rgba(255,152,0,.2);color:var(--orange)}
.access-badge.closed{background:rgba(244,67,54,.2);color:var(--red)}
.access-detail{font-size:12px;color:var(--text2);line-height:1.4;margin-bottom:8px}
.access-cols{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.access-col-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.access-col-title.best{color:var(--green)}
.access-col-title.restrict{color:var(--orange)}
.access-col p{font-size:11px;color:var(--text2);line-height:1.4}

/* ─── REGULATIONS ─── */
.reg-item{padding:10px 0 10px 14px;border-bottom:1px solid var(--bg3);border-left:3px solid var(--red);margin-left:0;font-size:13px;color:var(--text);line-height:1.5;margin-bottom:4px}
.reg-item:last-child{border-bottom:none}

/* ─── PRO TIPS ─── */
.tip-cat{margin-bottom:14px}
.tip-cat-badge{display:inline-block;padding:3px 10px;border-radius:10px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:6px}
.tip{font-size:12px;color:var(--text2);line-height:1.5;padding:6px 0 6px 0;border-bottom:1px solid var(--bg3)}
.tip:last-child{border-bottom:none}

/* ─── MISC ─── */
.loading{text-align:center;padding:24px;color:var(--text2)}
.loading .spinner{width:28px;height:28px;border:3px solid var(--bg3);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 10px}
@keyframes spin{to{transform:rotate(360deg)}}
.error-msg{text-align:center;padding:16px;color:var(--orange);font-size:13px}
.retry-btn{background:var(--accent);color:#000;border:none;padding:8px 20px;border-radius:20px;font-weight:700;font-size:12px;cursor:pointer;margin-top:8px;font-family:inherit}
.refresh-btn{background:none;border:1px solid var(--bg3);color:var(--text2);padding:4px 12px;border-radius:12px;font-size:10px;cursor:pointer;font-family:inherit;font-weight:600;float:right;margin-top:-2px}
.refresh-btn:active{background:var(--bg3)}
.footer{text-align:center;padding:16px;font-size:10px;color:var(--text3);line-height:1.5}
.flow-badge{display:inline-flex;align-items:center;gap:4px;background:var(--bg3);padding:4px 10px;border-radius:12px;font-size:12px;color:var(--text2);margin-top:6px}

/* ─── TACKLE LINKS ─── */
.tackle-links{display:flex;gap:6px;margin-top:6px}
.tackle-link{display:inline-flex;align-items:center;gap:3px;padding:3px 8px;border-radius:10px;font-size:10px;font-weight:600;text-decoration:none;transition:all .2s;font-family:inherit}
.tackle-link.yt{background:rgba(255,0,0,.1);color:#ff4444;border:1px solid rgba(255,0,0,.2)}
.tackle-link.yt:hover{background:rgba(255,0,0,.2)}
.tackle-link.shop{background:rgba(0,120,215,.1);color:#4a9eff;border:1px solid rgba(0,120,215,.2)}
.tackle-link.shop:hover{background:rgba(0,120,215,.2)}

/* ─── FEEDBACK WIDGET ─── */
.fb-fab{position:fixed;bottom:20px;right:20px;width:48px;height:48px;border-radius:50%;background:var(--accent);color:#000;border:none;font-size:20px;cursor:pointer;box-shadow:0 4px 16px rgba(0,188,212,.4);z-index:200;display:flex;align-items:center;justify-content:center;transition:transform .2s}
.fb-fab:active{transform:scale(.9)}
.fb-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:300;display:flex;align-items:flex-end;justify-content:center}
.fb-modal{background:var(--bg2);border-radius:16px 16px 0 0;width:100%;max-width:480px;padding:20px;max-height:80vh;overflow-y:auto}
.fb-modal h3{font-size:16px;font-weight:700;margin-bottom:12px;color:#fff}
.fb-rating{display:flex;gap:8px;margin-bottom:14px}
.fb-rating-btn{flex:1;padding:10px;border-radius:var(--radius-sm);border:2px solid var(--bg3);background:var(--bg3);font-size:24px;cursor:pointer;transition:all .2s;text-align:center}
.fb-rating-btn.active{border-color:var(--accent);background:rgba(0,188,212,.1)}
.fb-cats{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:14px}
.fb-cat{padding:6px 12px;border-radius:16px;font-size:11px;font-weight:600;border:1.5px solid var(--bg3);background:var(--bg3);color:var(--text2);cursor:pointer;transition:all .2s;font-family:inherit}
.fb-cat.active{border-color:var(--accent);color:var(--accent);background:rgba(0,188,212,.08)}
.fb-text{width:100%;background:var(--bg);border:1px solid var(--bg3);border-radius:var(--radius-sm);padding:10px;color:var(--text);font-family:inherit;font-size:13px;resize:vertical;min-height:60px;margin-bottom:14px}
.fb-text::placeholder{color:var(--text3)}
.fb-actions{display:flex;gap:8px}
.fb-submit{flex:1;padding:10px;border:none;border-radius:var(--radius-sm);font-weight:700;font-size:12px;cursor:pointer;font-family:inherit;display:flex;align-items:center;justify-content:center;gap:4px}
.fb-submit.primary{background:var(--accent);color:#000}
.fb-submit.secondary{background:var(--bg3);color:var(--text2)}
.fb-toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--green);color:#fff;padding:10px 20px;border-radius:20px;font-size:12px;font-weight:600;z-index:400;animation:fadeInUp .3s ease}
@keyframes fadeInUp{from{opacity:0;transform:translateX(-50%) translateY(10px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}

/* ─── SUPPORT FOOTER ─── */
.support-links{display:flex;gap:10px;justify-content:center;margin-top:8px}
.support-link{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:12px;font-size:10px;font-weight:600;text-decoration:none;transition:all .2s}
.support-link.kofi{background:rgba(255,94,91,.1);color:#ff5e5b;border:1px solid rgba(255,94,91,.2)}
.support-link.gh{background:rgba(255,255,255,.06);color:var(--text2);border:1px solid rgba(255,255,255,.1)}
</style>
</head>
<body>
<div id="root"></div>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const { useState, useEffect, useCallback, useMemo } = React;

// ─── WATER BODY DATA ───────────────────────────────────────
const WATERS = {
  greers: {
    name: "Greers Ferry Lake", short: "Greers Ferry", type: "lake",
    usgs: "07075900", lat: 35.5597, lon: -92.1526,
    nwsOffice: "LZK",
    alert: null,
    access: [
      { name: "Dam Site Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "Main Corps of Engineers park. Full facilities including camping, marina, and boat ramps.",
        bestFor: "Main lake access, deep structure fishing, bass and crappie",
        restrictions: "Corps day-use fees apply. 30-day camping limit." },
      { name: "Heber Springs City Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "City-operated facility near Heber Springs. Multiple ramps, courtesy dock, parking.",
        bestFor: "North end access, pre-spawn staging areas, convenient town location",
        restrictions: "Busiest on weekends spring through fall. Arrive early." },
      { name: "Sugarloaf Marina", type: "boat", status: "open", statusLabel: "Open",
        detail: "Private marina with full services. Fuel, supplies, boat rentals available.",
        bestFor: "Upper lake access, protected coves, crappie staging areas",
        restrictions: "Private facility. Launch fees apply." },
      { name: "Devils Fork", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps recreation area on south side. Camping, swimming beach, boat ramp.",
        bestFor: "South shore points, white bass runs into creeks, family-friendly",
        restrictions: "Corps fees apply. Popular summer destination." }
    ],
    regs: [
      "Arkansas state fishing license required",
      "White bass: 25 daily limit, no minimum length",
      "Crappie: 15 daily limit, no minimum length",
      "US Army Corps of Engineers regulations apply",
      "No wake zones near all boat ramps and swimming areas",
      "Check current AGFC regulations for any special restrictions"
    ],
    tips: [
      { cat: "Behavior", text: "Greers Ferry white bass stage in deep water (30-60ft) in winter, then move shallow in spring. Target main lake points and creek channels during pre-spawn." },
      { cat: "Timing", text: "Spring run peaks when water hits 50-58°F, usually March-April. Fish move into major creeks (South Fork, Little Red River arm)." },
      { cat: "Structure", text: "Greers Ferry has excellent rock structure. Bluff walls, gravel points, and chunk rock produce year-round. Mark underwater humps with GPS." },
      { cat: "Post-Spawn", text: "After spawn, white bass suspend over deep water near creek channels. Look for birds working baitfish May-June." },
      { cat: "Safety", text: "Greers Ferry is a large, deep lake. Weather can change quickly. Monitor wind and storms, especially on main lake." }
    ],
    crTips: [
      { cat: "Behavior", text: "Greers Ferry crappie are known for size. Fish deep brush piles (20-35ft) in winter. AGFC has mapped fish attractors \u2014 download GPS coordinates." },
      { cat: "Timing", text: "Crappie spawn staging begins at 55°F. Look for shallow buck brush, flooded timber, and boat docks in protected coves March-April." },
      { cat: "Structure", text: "Standing timber in creek arms holds crappie year-round. Narrows, Sugarloaf area, and upper Devils Fork have excellent timber." },
      { cat: "Technique", text: "Spider rigging with 8-16 rods is extremely popular on Greers Ferry. Slow-troll crappie jigs over brush at 1.5-2.5 mph." },
      { cat: "Night Fishing", text: "Submersible lights over deep brush (May-Sept) produce trophy crappie. Fish 18-30ft depths." }
    ]
  },
  maumelle: {
    name: "Lake Maumelle", short: "Maumelle", type: "lake",
    usgs: "072632995", lat: 34.8306, lon: -92.5806,
    nwsOffice: "LZK",
    alert: "\u26A0 2025-26: WestRock Landing ramps under renovation (new 4-lane facility). Sleepy Hollow open. Lake ~9ft low for CAW dam work.",
    access: [
      { name: "WestRock Landing", type: "boat", status: "limited", statusLabel: "Construction",
        detail: "Main lake south shore off Hwy 10. New 4-lane ramp under construction (2025). $5 launch fee.",
        bestFor: "Full lake access, tournaments, main lake points",
        restrictions: "Boats \u226514ft east of Hwy 10 bridge. Restricted zone near dam. RAMP UNDER RENOVATION \u2014 check status." },
      { name: "Sleepy Hollow Access", type: "boat", status: "open", statusLabel: "Open",
        detail: "West end, AGFC operated. FREE. 25 HP max. Two ramps + courtesy dock + campground.",
        bestFor: "West end creeks, pre-spawn staging areas, quiet fishing",
        restrictions: "25 HP max. West of Hwy 10 bridge only. No wake zone near ramp." },
      { name: "Crystal Hill Access", type: "boat", status: "open", statusLabel: "Open",
        detail: "East end access. Concrete ramp, good for east-end fishing. Porta-john available.",
        bestFor: "East end points, warmer water early spring",
        restrictions: "Limited parking on weekends. Standard CAW rules." },
      { name: "Maumelle River Parks", type: "bank", status: "open", statusLabel: "Open",
        detail: "Multiple small parks along Hwy 10. Pull-offs near lake. 70 miles of shoreline.",
        bestFor: "Post-spawn white bass near bridge pilings (May-Jun). Casual bank fishing.",
        restrictions: "Roadside parking. Respect CAW watershed rules." }
    ],
    regs: [
      "Municipal water supply \u2014 Central Arkansas Water (CAW) rules apply ON TOP of AGFC regs",
      "NO swimming, wading, water skiing, jet skis, or personal watercraft \u2014 anywhere on lake",
      "Boats must be \u226514ft east of Hwy 10 bridge (main lake section)",
      "Kayaks & canoes ONLY west of Hwy 10 bridge",
      "Restricted zone near dam \u2014 NO boating or fishing",
      "Factory-installed or equivalent exhausts required for all boat motors",
      "White bass daily limit: 25 fish (no minimum length) \u2014 verify current AGFC regs",
      "CAW Watershed Hotline: 501-868-4391 \u00B7 carkw.com"
    ],
    tips: [
      { cat: "Behavior", text: "Males run upstream first (smaller fish). Big females follow 1-2 weeks later." },
      { cat: "Timing", text: "Fish don't bite much during active spawn \u2014 target pre-spawn and post-spawn windows." },
      { cat: "Timing", text: "Best bite: First calm, sunny morning after a warming trend pushes water above 50\u00B0F." },
      { cat: "Access", text: "Kayaks allowed west of Hwy 10 bridge \u2014 excellent for reaching the spawning runs in Maumelle River." },
      { cat: "Timing", text: "The run can happen late Feb (warm years) or push to mid-April (cold springs). Watch the water temp, not the calendar." },
      { cat: "Post-Spawn", text: "After the run, look for white bass near Hwy 10 bridge pilings through June." },
      { cat: "Safety", text: "Lake is ~9ft low (2025-26 dam work). Use EXTREME caution. Know the lake before boating." },
      { cat: "Structure", text: "AGFC fish attractors (PVC structures) hold baitfish \u2014 download GPS coords from AGFC fishing map." }
    ],
    crTips: [
      { cat: "Behavior", text: "Maumelle crappie key on brush piles and standing timber. Download AGFC fish attractor GPS coords \u2014 these hold fish year-round." },
      { cat: "Timing", text: "Crappie spawn later than white bass. Look for bed spawn activity in March-April when water hits 60-65\u00B0F near stumps and laydowns." },
      { cat: "Timing", text: "Best bite: Overcast days with stable or rising barometric pressure. Pre-frontal feeding frenzy is real for crappie." },
      { cat: "Access", text: "West end (Sleepy Hollow) has excellent shallow timber for spring crappie. 25HP max keeps it quiet." },
      { cat: "Structure", text: "Low water (2025-26 dam work) exposes brush lines \u2014 mark these spots. When water returns, these are crappie magnets." },
      { cat: "Behavior", text: "Night fishing with submersible lights at brush piles produces slabs May-September. Focus 18-25ft depths." },
      { cat: "Safety", text: "Lake is ~9ft low (2025-26 dam work). Submerged timber is a hazard. Use extreme caution, especially at night." }
    ]
  },
  whiteRiver: {
    name: "White River", short: "White R.", type: "river",
    usgs: "07074500", lat: 35.6056, lon: -91.2131,
    nwsOffice: "LZK",
    alert: null,
    access: [
      { name: "Batesville City Ramp", type: "boat", status: "open", statusLabel: "Open",
        detail: "Concrete ramp with good parking. Popular staging area.",
        bestFor: "Access to prime white bass staging areas",
        restrictions: "Can be crowded during spring run. Arrive early." },
      { name: "Calico Rock Access", type: "boat", status: "open", statusLabel: "Open",
        detail: "Paved ramp, excellent for upstream float trips. Camping nearby.",
        bestFor: "Float trips during spawn run, upper river access",
        restrictions: "Check generation schedule before launching." },
      { name: "Guion Access", type: "boat", status: "open", statusLabel: "Open",
        detail: "Gravel ramp. Less crowded \u2014 good alternative when Batesville is packed.",
        bestFor: "Mid-river access, less pressure",
        restrictions: "Gravel ramp \u2014 4WD recommended in wet conditions." },
      { name: "Newport White River Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "Full-service ramp. Great for lower White River runs.",
        bestFor: "Lower river white bass, easy access",
        restrictions: "Standard AGFC regulations." }
    ],
    regs: [
      "Arkansas state fishing license required",
      "White bass: 25 daily limit, no minimum length",
      "Trout regulations apply below Bull Shoals & Norfork dams",
      "Generation schedules affect water levels \u2014 check USACE before wading",
      "No trotlines within 100 yards of any dam",
      "Check AGFC for current season dates and special regulations"
    ],
    tips: [
      { cat: "Behavior", text: "White bass run up tributaries in spring \u2014 focus on creek mouths where current meets slack water." },
      { cat: "Timing", text: "The spring run typically peaks when water hits 55-60\u00B0F. Generation schedules matter more here than on lakes." },
      { cat: "Structure", text: "Rocky points and gravel bars are prime staging areas. Fish eddies behind large rocks." },
      { cat: "Safety", text: "Always check dam generation schedules before wading. Current can be deceptively strong." }
    ],
    crTips: [
      { cat: "Behavior", text: "White River crappie hold in oxbow sloughs and backwater eddies. Target wood cover adjacent to main channel." },
      { cat: "Timing", text: "Crappie spawn in backwater areas when water stabilizes at 60-65\u00B0F. Generation releases delay spawn in main channel." },
      { cat: "Structure", text: "Laydowns and root wads in 3-8ft of slack water are prime spring crappie spots. Look for protected coves." },
      { cat: "Safety", text: "Check USACE generation schedules \u2014 rising water scatters crappie from beds. Stable levels are critical for spawn." }
    ]
  },
  buffalo: {
    name: "Buffalo National River", short: "Buffalo R.", type: "river",
    usgs: "07056000", lat: 35.9828, lon: -92.7464,
    nwsOffice: "LZK",
    alert: null,
    access: [
      { name: "Rush Landing", type: "boat", status: "open", statusLabel: "Open",
        detail: "National Park Service maintained. Good ramp for lower Buffalo.",
        bestFor: "Lower Buffalo white bass, NPS camping",
        restrictions: "NPS regulations apply. Pack in/pack out." },
      { name: "Buffalo Point", type: "boat", status: "open", statusLabel: "Open",
        detail: "NPS campground with ramp access. Reservations recommended in season.",
        bestFor: "Family trips, camping + fishing combo",
        restrictions: "Reservations recommended. NPS fees may apply." },
      { name: "Gilbert Access", type: "boat", status: "open", statusLabel: "Open",
        detail: "Gravel launch, limited parking. Best for mid-river access.",
        bestFor: "Mid-river float fishing",
        restrictions: "Limited parking. Gravel launch." },
      { name: "Hwy 14 Bridge Access", type: "bank", status: "open", statusLabel: "Open",
        detail: "Bank access and wade fishing. Popular for smallmouth & white bass.",
        bestFor: "Wade fishing, bank access",
        restrictions: "Check water levels. No facilities." }
    ],
    regs: [
      "National Park Service regulations apply \u2014 NPS fishing permit may be required",
      "Arkansas state fishing license required in addition to NPS rules",
      "White bass: 25 daily limit, no minimum length (state regs)",
      "Special trout regulations may apply in certain sections",
      "No litter \u2014 pack in, pack out (Leave No Trace)",
      "Check water levels before floating \u2014 the Buffalo can be too low or too high"
    ],
    tips: [
      { cat: "Behavior", text: "White bass enter the Buffalo from the White River during spring runs. Focus on lower Buffalo below Gilbert." },
      { cat: "Timing", text: "Spring run timing depends on White River water temps. Float trips during the run produce incredible numbers." },
      { cat: "Access", text: "Water levels fluctuate dramatically \u2014 check USGS gauge before going. 400-2000 cfs is ideal for fishing floats." },
      { cat: "Safety", text: "The Buffalo is a wild river \u2014 no dam controls. Conditions can change rapidly." }
    ],
    crTips: [
      { cat: "Behavior", text: "Crappie are not common in the main Buffalo channel. Target backwater pools and slow eddies near the White River confluence." },
      { cat: "Timing", text: "Lower Buffalo near the White River may hold crappie during spring when water levels allow backwater access." },
      { cat: "Access", text: "Float the lower section below Gilbert for best shot at crappie. Water must be 400+ cfs and relatively stable." },
      { cat: "Safety", text: "Wild river with no controls. Water levels can change fast \u2014 always check USGS gauge." }
    ]
  },
  bullshoals: {
    name: "Bull Shoals Lake", short: "Bull Shoals", type: "lake",
    usgs: "07054500", lat: 36.3700, lon: -92.5825,
    nwsOffice: "SGF",
    alert: null,
    access: [
      { name: "Bull Shoals State Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "Arkansas State Parks facility. Multiple ramps, marina, camping, visitor center.",
        bestFor: "Main lake access, deep structure, rental boats available",
        restrictions: "State park entry fee. Camping reservations recommended." },
      { name: "Lead Hill Public Use Area", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps of Engineers facility. Free launch, limited facilities.",
        bestFor: "Upper lake access, creek arms, less crowded",
        restrictions: "No camping. Primitive facilities." },
      { name: "Oakland Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "City of Oakland park near dam. Ramp, parking, picnic area.",
        bestFor: "Dam area fishing, deep water access",
        restrictions: "Limited parking on busy weekends." },
      { name: "Tucker Hollow", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps recreation area. Camping, ramp, swim beach.",
        bestFor: "Mid-lake access, family camping and fishing",
        restrictions: "Corps day-use fees. Busy in summer." }
    ],
    regs: [
      "Arkansas state fishing license required",
      "White bass: 25 daily limit, no minimum length",
      "Crappie: 15 daily limit, no minimum length",
      "Below dam: trout regulations apply - separate license",
      "US Army Corps of Engineers regulations apply",
      "Check AGFC for current season dates and any special restrictions"
    ],
    tips: [
      { cat: "Behavior", text: "Bull Shoals white bass school heavily on main lake points in winter. Look for birds and surface activity over 40-80ft water." },
      { cat: "Timing", text: "Spring run begins when water reaches 48-52°F. Fish stage at creek mouths before moving into major tributaries." },
      { cat: "Structure", text: "Bull Shoals has incredible bluff walls and rock structure. Vertical jig bluffs in winter, target gravel points in spring." },
      { cat: "Tailwater", text: "Below dam tailwater produces white bass when fish are running upstream. Best during generation releases April-May." },
      { cat: "Safety", text: "Bull Shoals is massive (45,000 acres). Wind can create dangerous waves. Check weather before heading to main lake." }
    ],
    crTips: [
      { cat: "Behavior", text: "Bull Shoals crappie suspend over deep structure in winter (30-50ft). Mark schools on electronics, vertical jig slowly." },
      { cat: "Timing", text: "Crappie move to shallow brush and docks when water hits 58-62°F, typically late March-April." },
      { cat: "Structure", text: "Target flooded cedar trees in creek arms, boat docks, and submerged brush piles. AGFC fish attractors marked on lake maps." },
      { cat: "Technique", text: "Bull Shoals crappie run big. Use 1/8oz jigs with 4lb line. Long-line trolling crankbaits is popular in summer." },
      { cat: "Night Fishing", text: "Lighted docks and brush piles produce excellent summer crappie fishing. Focus on 15-25ft depths." }
    ]
  },
  beaver: {
    name: "Beaver Lake", short: "Beaver", type: "lake",
    usgs: "07049000", lat: 36.3722, lon: -93.9731,
    nwsOffice: "TSA",
    alert: null,
    access: [
      { name: "Dam Site Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps of Engineers park at Beaver Dam. Full facilities, multiple ramps, camping.",
        bestFor: "Lower lake access, deep water fishing, striped bass",
        restrictions: "Corps day-use fees. Popular tournament site." },
      { name: "Prairie Creek", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps recreation area on Highway 62. Well-maintained ramps, camping, marina.",
        bestFor: "Upper lake access, protected coves, white bass and crappie",
        restrictions: "Busiest Corps park on Beaver. Arrive early spring weekends." },
      { name: "Hickory Creek", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps park on mid-lake. Good ramp, less crowded than Prairie Creek.",
        bestFor: "Mid-lake points, creek fishing, quieter alternative",
        restrictions: "Corps fees apply." },
      { name: "Rocky Branch", type: "boat", status: "open", statusLabel: "Open",
        detail: "Upper lake Corps facility. Gravel ramp, primitive camping.",
        bestFor: "Upper lake creeks, shallow water spawn fishing",
        restrictions: "Gravel ramp. Check water levels before launching larger boats." }
    ],
    regs: [
      "Arkansas state fishing license required",
      "White bass: 25 daily limit, no minimum length",
      "Crappie: 15 daily limit, no minimum length",
      "Striped bass: 2 daily limit, 20\" minimum length",
      "US Army Corps of Engineers regulations apply",
      "Check AGFC for current regulations and any special restrictions"
    ],
    tips: [
      { cat: "Behavior", text: "Beaver Lake white bass migrate up War Eagle Creek, White River arm, and other major tributaries during spring spawn." },
      { cat: "Timing", text: "Spawn run typically peaks in March-April when water is 50-58°F. Fish stage on main lake points first, then move to creeks." },
      { cat: "Structure", text: "Beaver has excellent chunk rock, gravel bars, and bluff walls. Winter fish hold deep (40-60ft) on main lake structure." },
      { cat: "Technique", text: "Jigging spoons and blade baits work well for suspended white bass over deep water. Switch to inline spinners in creeks during spawn." },
      { cat: "Post-Spawn", text: "After spawn, look for white bass chasing shad on main lake. Surface activity common May-June near creek mouths." }
    ],
    crTips: [
      { cat: "Behavior", text: "Beaver Lake is known for trophy crappie (2-3 lbs common). Fish deep standing timber and brush piles in winter." },
      { cat: "Timing", text: "Crappie spawn in upper lake coves and creek arms when water reaches 60-65°F. War Eagle Creek and upper White River arm are prime areas." },
      { cat: "Structure", text: "Look for standing timber in 8-20ft during pre-spawn. Shallow brush, docks, and buck brush hold spawning fish." },
      { cat: "Technique", text: "Beaver crappie are big and fight hard. Use 1/8-1/4oz jigs. Spider rigging is popular for covering water quickly." },
      { cat: "Night Fishing", text: "Submersible lights attract shad and crappie. Fish deep brush (20-30ft) in summer. Green lights work best." }
    ]
  },
  ouachita: {
    name: "Lake Ouachita", short: "Ouachita", type: "lake",
    usgs: "07357000", lat: 34.5553, lon: -93.1900,
    nwsOffice: "LZK",
    alert: null,
    access: [
      { name: "Lake Ouachita State Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "Arkansas State Parks facility near Hot Springs. Full marina, camping, cabins, restaurant.",
        bestFor: "Lower lake access, deep water fishing, family camping",
        restrictions: "State park entry fee. Popular destination \u2014 reserve camping ahead." },
      { name: "Denby Point", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps of Engineers recreation area. Multiple ramps, camping, swim beach.",
        bestFor: "Mid-lake access, protected coves, crappie fishing",
        restrictions: "Corps day-use fees apply." },
      { name: "Brady Mountain", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps facility on north shore. Good ramp, camping available.",
        bestFor: "Upper lake access, creek fishing, less crowded",
        restrictions: "Primitive facilities compared to State Park." },
      { name: "Crystal Springs", type: "boat", status: "open", statusLabel: "Open",
        detail: "Private marina with full services. Fuel, supplies, boat rentals.",
        bestFor: "Upper lake, creek arms, convenient supplies",
        restrictions: "Private facility. Launch fees apply." }
    ],
    regs: [
      "Arkansas state fishing license required",
      "White bass: 25 daily limit, no minimum length (verify current AGFC regs)",
      "Crappie: 15 daily limit, no minimum length",
      "Striped bass regulations: check AGFC for current limits and lengths",
      "US Army Corps of Engineers regulations apply",
      "Lake Ouachita is also known for walleye \u2014 special regulations may apply"
    ],
    tips: [
      { cat: "Behavior", text: "Lake Ouachita white bass winter deep (50-100ft) on main lake structure. Spring staging begins on mid-depth points and humps." },
      { cat: "Timing", text: "Spring run peaks when water hits 52-58°F. Fish move into Blakely Creek, South Fork, and other major tributaries." },
      { cat: "Structure", text: "Ouachita is Arkansas's largest and deepest lake (48,000 acres, 200+ ft deep). GPS essential. Mark humps, points, and creek channels." },
      { cat: "Clarity", text: "Ouachita has exceptional water clarity. Use lighter line and natural colors. Fish can be spooky in clear water." },
      { cat: "Safety", text: "Large lake with open water. Wind creates serious waves. Monitor weather. Fog is common early mornings." }
    ],
    crTips: [
      { cat: "Behavior", text: "Ouachita crappie suspend over deep structure in winter. Look for schools on electronics in 30-60ft over main lake humps." },
      { cat: "Timing", text: "Crappie move shallow when water hits 58-63°F. Target buck brush, flooded timber, and boat docks in protected coves." },
      { cat: "Structure", text: "Upper lake creek arms have excellent standing timber. Blakely Creek, Glazypeau, and Chickasaw Cove are known crappie areas." },
      { cat: "Clarity", text: "Clear water means crappie can see line. Use 4-6lb fluorocarbon. Natural colors (silver, white, translucent) work best." },
      { cat: "Technique", text: "Vertical jigging deep timber with light jigs (1/16-1/8oz) is effective. Slow presentation in clear water is key." }
    ]
  },
  conway: {
    name: "Lake Conway", short: "Conway", type: "lake",
    usgs: null, lat: 34.9667, lon: -92.3833,
    nwsOffice: "LZK",
    alert: "\u26A0 Lake under renovation by AGFC. Water levels may be low. Check AGFC Lake Conway page for current status and access.",
    access: [
      { name: "Palarm Creek Access", type: "boat", status: "limited", statusLabel: "Check AGFC",
        detail: "AGFC boat ramp. Primary access point for Lake Conway.",
        bestFor: "Main lake access \u2014 verify ramp status during renovation",
        restrictions: "AGFC regulations. Check current access status due to renovation project." },
      { name: "Point Remove Access", type: "boat", status: "limited", statusLabel: "Check AGFC",
        detail: "AGFC facility on north end. Limited parking.",
        bestFor: "North end fishing \u2014 verify status before going",
        restrictions: "Limited facilities. AGFC regs apply. Renovation may affect access." }
    ],
    regs: [
      "Arkansas state fishing license required",
      "Crappie: 15 daily limit, 10\" minimum length (verify current AGFC regs)",
      "White bass: check AGFC regulations for current limits",
      "AGFC Game and Fish Commission lake \u2014 special regulations apply",
      "Lake is undergoing major renovation \u2014 check AGFC website for current rules and access status",
      "No bow fishing allowed (AGFC regulation)"
    ],
    tips: [
      { cat: "Status", text: "Lake Conway is undergoing AGFC renovation project. Water levels and access may be limited. Always check AGFC website before planning trip." },
      { cat: "Behavior", text: "Historically, Conway white bass stage near dam and in creek channels during pre-spawn. Fish tend to school heavily." },
      { cat: "Structure", text: "Conway is known for cypress trees and stumps. Fish break lines and channels near timber." },
      { cat: "Timing", text: "Spring fishing typically peaks March-April at 50-58°F water temps." }
    ],
    crTips: [
      { cat: "Status", text: "Conway is famous for big crappie, but lake is currently under renovation. Access and fishing may be limited \u2014 check AGFC first." },
      { cat: "Behavior", text: "Conway crappie traditionally school in cypress stands and flooded timber. Target mid-depth wood structure (6-12ft)." },
      { cat: "Timing", text: "Pre-spawn staging happens when water reaches 55-60°F. Fish move to shallow cypress and stumps for spawn." },
      { cat: "Technique", text: "Tight-line jigging around cypress trees is classic Conway technique. Use 1/16oz jigs with live minnows." }
    ]
  },
  degray: {
    name: "DeGray Lake", short: "DeGray", type: "lake",
    usgs: "07360200", lat: 34.1958, lon: -93.0694,
    nwsOffice: "LZK",
    alert: null,
    access: [
      { name: "DeGray Lake Resort State Park", type: "boat", status: "open", statusLabel: "Open",
        detail: "Premier Arkansas State Park. Full-service marina, lodge, restaurant, camping, golf course.",
        bestFor: "Main lake access, deep structure fishing, family destination",
        restrictions: "State park entry fee. Lodge and marina are popular \u2014 book ahead." },
      { name: "Edgewood Bay", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps of Engineers recreation area. Ramp, camping, swim beach.",
        bestFor: "Upper lake access, cove fishing, camping",
        restrictions: "Corps day-use fees apply." },
      { name: "Arlie Moore", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps facility near dam. Primitive camping, ramp access.",
        bestFor: "Dam area fishing, deep water access",
        restrictions: "Limited facilities. Corps fees." },
      { name: "Iron Mountain", type: "boat", status: "open", statusLabel: "Open",
        detail: "Corps park on upper lake. Good ramp, camping.",
        bestFor: "Upper lake creeks, quieter fishing",
        restrictions: "Gravel roads to access. Check Corps website for seasonal closures." }
    ],
    regs: [
      "Arkansas state fishing license required",
      "White bass: 25 daily limit, no minimum length (verify AGFC regs)",
      "Crappie: 15 daily limit, no minimum length",
      "US Army Corps of Engineers regulations apply",
      "DeGray is known for trophy largemouth bass \u2014 consider catch and release for big fish",
      "Check AGFC for current season dates and any special restrictions"
    ],
    tips: [
      { cat: "Behavior", text: "DeGray white bass suspend over main lake structure in winter. Spring staging happens on secondary points near creek channels." },
      { cat: "Timing", text: "White bass spawn run peaks when water reaches 50-56°F, usually March-April. Target Caddo River arm and major creek mouths." },
      { cat: "Structure", text: "DeGray has excellent standing timber in creek arms. Also fish submerged roadbeds, humps, and channel drops." },
      { cat: "Clarity", text: "DeGray water clarity varies by season. Spring runoff can stain upper creeks. Main lake is typically clear." },
      { cat: "Resort", text: "DeGray Resort State Park has a full-service marina. Guides available. Good destination for family fishing trips." }
    ],
    crTips: [
      { cat: "Behavior", text: "DeGray crappie hold deep on brush piles and timber in winter (20-40ft). AGFC maintains fish attractors \u2014 get GPS coords." },
      { cat: "Timing", text: "Crappie spawn when water reaches 60-65°F. Look for shallow standing timber, brush, and boat docks in creek arms." },
      { cat: "Structure", text: "Caddo River arm and upper creek channels have prime crappie habitat. Target wood cover in 3-12ft during spawn." },
      { cat: "Technique", text: "DeGray is known for brush pile crappie fishing. Vertical jig with electronics to locate fish on structure." },
      { cat: "Night Fishing", text: "Summer night fishing with lights over brush piles is very productive. Fish 15-30ft depths. Green lights attract shad." }
    ]
  }
};

const WATER_LEVEL_SOURCES = {
  greers: {
    provider: "USACE-SWL snapshot + USGS",
    primaryUrl: "https://www.swl-wc.usace.army.mil/pages/data/tabular/htm/greersf.htm",
    notes: "Corps reservoir table is scraped during GitHub deploy/scheduled refresh.",
  },
  bullshoals: {
    provider: "USACE-SWL snapshot + USGS",
    primaryUrl: "https://www.swl-wc.usace.army.mil/pages/data/tabular/htm/bulsdam.htm",
    notes: "Corps release/elevation fills gaps when USGS series is unavailable.",
  },
  beaver: {
    provider: "USACE-SWL snapshot + USGS",
    primaryUrl: "https://www.swl-wc.usace.army.mil/pages/data/tabular/htm/beaver.htm",
    notes: "Corps release/elevation complements USGS station data.",
  },
  maumelle: {
    provider: "USGS gauge",
    primaryUrl: "https://waterdata.usgs.gov/",
    notes: "Municipal reservoir; Corps table integration not currently targeted.",
  },
  whiteriver: {
    provider: "USGS river gauge",
    primaryUrl: "https://waterdata.usgs.gov/",
    notes: "River conditions come from USGS flow/gage stations.",
  },
  buffalo: {
    provider: "USGS river gauge",
    primaryUrl: "https://waterdata.usgs.gov/",
    notes: "Wild river monitoring via USGS flow/gage stations.",
  },
  ouachita: {
    provider: "USACE-MVK snapshot + USGS",
    primaryUrl: "https://www.mvk-wc.usace.army.mil/resrep.htm",
    notes: "MVK reservoir report is scraped during deploy/scheduled refresh for Blakely (Lake Ouachita).",
  },
  degray: {
    provider: "USACE-MVK snapshot + USGS",
    primaryUrl: "https://www.mvk-wc.usace.army.mil/resrep.htm",
    notes: "MVK reservoir report is scraped during deploy/scheduled refresh for DeGray.",
  },
  conway: {
    provider: "AGFC status + NWS",
    primaryUrl: "https://www.agfc.com/",
    notes: "No USGS gauge configured during renovation period.",
  },
};

const WB_PHASES = [
  { name: "Winter Hold", min: 0, max: 45, color: "#4fc3f7", icon: "\u2744\uFE0F", short: "Too cold. Fish are deep. Be patient." },
  { name: "Pre-Spawn Staging", min: 45, max: 50, color: "#29b6f6", icon: "\uD83C\uDF21\uFE0F", short: "Fish staging near creek mouths as water approaches 45-50\u00B0F. Males move first \u2014 smaller fish showing up at creek entries. Big females will follow when water consistently holds above 48\u00B0F. This is the \"watch and wait\" phase \u2014 but it's also your chance to scout." },
  { name: "Spawn Trigger", min: 50, max: 55, color: "#ff6b35", icon: "\uD83D\uDD25", short: "Fish moving to tributaries! Time to intercept at creek mouths and tributary entrances." },
  { name: "Peak Spawn", min: 55, max: 62, color: "#f44336", icon: "\uD83D\uDD25", short: "Active spawn run in tributaries and creek arms. This is prime time \u2014 get out there!" },
  { name: "Post-Spawn", min: 62, max: 68, color: "#66bb6a", icon: "\uD83C\uDF3F", short: "Fish returning to main body. Target creek mouths and mid-depth structure." },
  { name: "Summer Pattern", min: 68, max: 999, color: "#ffd54f", icon: "\u2600\uFE0F", short: "Fish schooling on main structure. Early/late bites best. Look for surface activity." }
];

const CR_PHASES = [
  { name: "Winter Deep", min: 0, max: 48, color: "#4fc3f7", icon: "\u2744\uFE0F", short: "Crappie holding in deep timber and brush piles. Vertical jig with minnows or small jigs at 15-25ft." },
  { name: "Pre-Spawn Move", min: 48, max: 55, color: "#ab47bc", icon: "\uD83C\uDF21\uFE0F", short: "Crappie moving from deep water toward shallow structure. Males scouting 6-12ft near wood cover and creek channels. Spider rig or slow-troll crankbaits." },
  { name: "Spawn Staging", min: 55, max: 60, color: "#e040fb", icon: "\uD83D\uDD2E", short: "Crappie staging on shallow wood \u2014 stumps, laydowns, brush at 3-8ft. Pitch jigs to visible cover. This is pre-spawn gold." },
  { name: "Bed Spawn", min: 60, max: 68, color: "#f44336", icon: "\uD83D\uDD25", short: "Crappie on beds in 1-5ft near bank cover, stumps, and docks. Sight-fish with small jigs. Peak crappie season!" },
  { name: "Post-Spawn", min: 68, max: 75, color: "#66bb6a", icon: "\uD83C\uDF3F", short: "Crappie pulling back to mid-depth brush and channel edges. Spider rig and trolling produce." },
  { name: "Summer Suspend", min: 75, max: 999, color: "#ffd54f", icon: "\u2600\uFE0F", short: "Crappie suspend over deep structure near thermocline. Night fishing with lights or deep spider rigging." }
];

const PHASES = WB_PHASES; // default

const LURES_BY_PHASE = {
  "Winter Hold": [
    { name: "White 2\" Bass Assassin Curly Shad Grub", sub: "on 1/16oz jighead", detail: "GO-TO. Cast upstream, slow roll with current." },
    { name: "1/8oz White Spinner", sub: "with silver blade", detail: "Backup. Flash triggers reaction strikes in moving water." },
    { name: "Blue/Orange Belly Rapala", sub: "suspending jerkbait (small)", detail: "Backup. Deadly in slack water or when fish are holding deep." }
  ],
  "Pre-Spawn Staging": [
    { name: "White 2\" Bass Assassin Curly Shad Grub", sub: "on 1/16oz jighead", detail: "GO-TO. Cast upstream, slow roll with current." },
    { name: "1/8oz White Spinner", sub: "with silver blade", detail: "Backup. Flash triggers reaction strikes in moving water." },
    { name: "Blue/Orange Belly Rapala", sub: "suspending jerkbait (small)", detail: "Backup. Deadly in slack water or when fish are holding deep." }
  ],
  "Spawn Trigger": [
    { name: "White 2\" Curly Shad Grub \u2014 1/16oz", sub: "cast upstream in tributaries", detail: "Retrieve with current. Let it tumble naturally." },
    { name: "Small White Rooster Tail", sub: "1/16oz inline spinner", detail: "Fan cast creek mouths. Steady retrieve." },
    { name: "1/8oz White Spinner", sub: "silver blade", detail: "Run parallel to current seams at tributary entrances." }
  ],
  "Peak Spawn": [
    { name: "White Rooster Tail \u2014 1/16oz", sub: "inline spinner", detail: "Cast into current and retrieve steadily. Cover water fast." },
    { name: "White Curly Tail Grub \u2014 1/16oz", sub: "jighead", detail: "Dead drift through runs, then swim out. Deadly technique." },
    { name: "Small Chrome Kastmaster", sub: "1/8oz casting spoon", detail: "Long casts into rapids. Let it swing in current." }
  ],
  "Post-Spawn": [
    { name: "Small White Crankbait", sub: "shallow diving", detail: "Burn it past creek mouth transitions. Reaction strikes." },
    { name: "1/4oz White Spinner", sub: "silver willow blade", detail: "Cover water along main body shorelines." },
    { name: "Topwater \u2014 White Tiny Torpedo", sub: "surface bait", detail: "Early morning surface bites can be explosive post-spawn." }
  ],
  "Summer Pattern": [
    { name: "White Slab Spoon \u2014 1/2oz", sub: "vertical jigging", detail: "Vertical jig over schools. Match their depth on electronics." },
    { name: "Topwater Pencil Popper", sub: "walk-the-dog action", detail: "When you see surface busting, throw into the fray." },
    { name: "Paddle Tail Swimbait \u2014 White", sub: "steady retrieve", detail: "Steady retrieve through schooling fish at dawn/dusk." }
  ]
};

const CR_LURES_BY_PHASE = {
  "Winter Deep": [
    { name: "1/16oz Jig + Live Minnow", sub: "vertical presentation", detail: "GO-TO. Drop to brush piles, hold 6\" off bottom. Slow lift-drop." },
    { name: "Bobby Garland Baby Shad", sub: "1.5\" on 1/32oz jighead", detail: "Backup. Slow fall through timber. Chartreuse/white or monkey milk." },
    { name: "Jigging Spoon \u2014 1/8oz", sub: "flutter spoon", detail: "Deep timber. Let it flutter on the fall." }
  ],
  "Pre-Spawn Move": [
    { name: "Road Runner Jig \u2014 1/16oz", sub: "chartreuse/white", detail: "GO-TO. Slow-roll along creek channels and brush lines at 8-12ft." },
    { name: "Live Minnow Under Cork", sub: "set 6-8ft deep", detail: "Fan cast around submerged brush. Let minnow do the work." },
    { name: "Strike King Mr. Crappie", sub: "slabalicious 1/8oz", detail: "Slow troll along channel edges. Chartreuse or ghost pattern." }
  ],
  "Spawn Staging": [
    { name: "1/32oz Jig + Tube", sub: "chartreuse/black flake", detail: "GO-TO. Pitch to stumps, laydowns, and visible brush at 3-8ft." },
    { name: "Bobby Garland Stroll'R", sub: "on 1/16oz jig", detail: "Swim past wood cover. Twitching retrieve." },
    { name: "Live Minnow \u2014 Tight Line", sub: "no bobber, 4lb fluoro", detail: "Pitch to stumps. Feel for the tick. Light line = more bites." }
  ],
  "Bed Spawn": [
    { name: "1/32oz Jig + Tube", sub: "white/chartreuse", detail: "GO-TO. Sight-fish beds near stumps and bank cover. Drop directly on bed." },
    { name: "Small Jig Under Slip Cork", sub: "set 2-4ft", detail: "Cast past bed, drift over it. Deadly for pressured fish." },
    { name: "Bobby Garland Baby Shad", sub: "monkey milk or electric chicken", detail: "Swim slowly through spawning flats. Cover more water." }
  ],
  "Post-Spawn": [
    { name: "Road Runner \u2014 1/8oz", sub: "white/chartreuse", detail: "GO-TO. Spider rig or cast to mid-depth brush. Steady retrieve." },
    { name: "Small Crankbait", sub: "shad pattern, 4-8ft diver", detail: "Troll or cast along channel edges and brush lines." },
    { name: "Live Minnow + Split Shot", sub: "tight-line near brush", detail: "Set at thermocline depth. Let them come to you." }
  ],
  "Summer Suspend": [
    { name: "Jigging Spoon \u2014 1/8oz", sub: "over deep brush", detail: "GO-TO. Vertical jig at thermocline (18-25ft). Steady lift-drop." },
    { name: "Small Swimbait", sub: "on 1/16oz jighead", detail: "Slow-roll through suspended fish. Watch electronics closely." },
    { name: "Live Minnow Under Light", sub: "night fishing", detail: "Green submersible light draws baitfish. Crappie follow. Summer secret weapon." }
  ]
};

const WB_CALENDAR = [
  { name: "Winter Hold", icon: "\u2744\uFE0F", months: "Dec\u2013Feb", desc: "White bass hold deep in creek/river channels. Slow jigging presentations.", where: "Deep channel bends, 20-30ft", lures: "Jigging spoons, blade baits, small jigs" },
  { name: "Pre-Spawn Staging", icon: "\uD83C\uDF21\uFE0F", months: "Late Feb\u2013Mar", desc: "Fish staging near creek mouths as water approaches 45-50\u00B0F. Males move first.", where: "Creek mouths, river channel intersections, Hwy 10 bridge area", lures: "1/16oz jig + 2\" white curly grub, small crankbaits" },
  { name: "The Spawn Run", icon: "\uD83D\uDD25", months: "Mar\u2013May", desc: "White bass run up tributaries when water hits 50-62\u00B0F. The main event.", where: "Tributaries, creek arms, river channels upstream", lures: "Rooster tails, inline spinners, curly tail grubs" },
  { name: "Post-Spawn", icon: "\uD83C\uDF3F", months: "May\u2013Jun", desc: "Fish return to main body. Great topwater action near structure.", where: "Creek mouths, bridge pilings, mid-depth points", lures: "Small crankbaits, topwater, spinners" },
  { name: "Summer Pattern", icon: "\u2600\uFE0F", months: "Jun\u2013Sep", desc: "Schooling fish on main lake structure. Dawn/dusk surface feeds.", where: "Main lake humps, points, open water schools", lures: "Slab spoons, swimbaits, topwater poppers" },
  { name: "Fall Transition", icon: "\uD83C\uDF42", months: "Oct\u2013Nov", desc: "Fish follow shad migration to creeks. Good numbers before winter.", where: "Creek channels, shad concentrations", lures: "Small crankbaits, jigs, blade baits" }
];

const CR_CALENDAR = [
  { name: "Winter Deep", icon: "\u2744\uFE0F", months: "Dec\u2013Feb", desc: "Crappie hold deep on brush piles, standing timber, and creek channels at 15-25ft.", where: "Deep brush piles, standing timber, creek channel bends", lures: "1/16oz jig + minnow, Bobby Garland Baby Shad, jigging spoons" },
  { name: "Pre-Spawn Move", icon: "\uD83C\uDF21\uFE0F", months: "Late Feb\u2013Mar", desc: "Crappie moving from deep water toward shallow structure as water approaches 48-55\u00B0F.", where: "Mid-depth brush lines, creek channel edges, 8-12ft", lures: "Road runner jigs, live minnow under cork, small crankbaits" },
  { name: "Spawn Staging", icon: "\uD83D\uDD2E", months: "Mar\u2013Apr", desc: "Crappie staging on shallow wood and brush at 55-60\u00B0F. Males fan beds first.", where: "Shallow stumps, laydowns, brush at 3-8ft", lures: "1/32oz jig + tube, Bobby Garland Stroll'R, tight-line minnow" },
  { name: "Bed Spawn", icon: "\uD83D\uDD25", months: "Apr\u2013May", desc: "Crappie on beds in 1-5ft near stumps, brush, and bank cover. 60-68\u00B0F water.", where: "Bank cover, stumps, shallow brush, 1-5ft", lures: "1/32oz tube jig, slip cork + jig, Bobby Garland Baby Shad" },
  { name: "Post-Spawn", icon: "\uD83C\uDF3F", months: "May\u2013Jun", desc: "Crappie pull back to mid-depth brush and channel edges. Spider rigs shine.", where: "Mid-depth brush, channel edges, 8-15ft", lures: "Road runners, small crankbaits, minnow + split shot" },
  { name: "Summer Suspend", icon: "\u2600\uFE0F", months: "Jun\u2013Oct", desc: "Crappie suspend near thermocline over deep structure. Night fishing with lights.", where: "Thermocline depth 18-25ft, deep brush, open water", lures: "Jigging spoons, small swimbaits, live minnow under light" }
];

const CALENDAR_PHASES = WB_CALENDAR;

function getPhase(temp, species) {
  const list = species === "cr" ? CR_PHASES : WB_PHASES;
  if (temp === null || temp === undefined) return list[0];
  for (const p of list) { if (temp >= p.min && temp < p.max) return p; }
  return list[list.length - 1];
}

function getPhaseIndex(temp, species) {
  const list = species === "cr" ? CR_PHASES : WB_PHASES;
  if (temp === null || temp === undefined) return 0;
  for (let i = 0; i < list.length; i++) { if (temp >= list[i].min && temp < list[i].max) return i; }
  return list.length - 1;
}

function getWxIcon(forecast) {
  const s = (forecast || "").toLowerCase();
  if (s.includes("thunder") || s.includes("storm")) return "\u26C8\uFE0F";
  if (s.includes("rain") || s.includes("shower")) return "\uD83C\uDF27\uFE0F";
  if (s.includes("snow") || s.includes("sleet")) return "\uD83C\uDF28\uFE0F";
  if (s.includes("fog")) return "\uD83C\uDF2B\uFE0F";
  if (s.includes("cloudy") && s.includes("partly")) return "\u26C5";
  if (s.includes("cloudy") && s.includes("mostly")) return "\uD83C\uDF25\uFE0F";
  if (s.includes("cloudy") || s.includes("overcast")) return "\u2601\uFE0F";
  if (s.includes("sunny") || s.includes("clear")) return "\u2600\uFE0F";
  return "\uD83C\uDF24\uFE0F";
}

function rateFishing(period) {
  const s = (period.shortForecast || "").toLowerCase();
  const temp = period.temperature || 50;
  let score = 5;
  if (s.includes("cloudy") || s.includes("overcast")) score += 2;
  if (s.includes("partly")) score += 1;
  if (s.includes("rain") && !s.includes("heavy")) score += 1;
  if (s.includes("heavy rain") || s.includes("storm") || s.includes("thunder")) score -= 3;
  if (s.includes("snow") || s.includes("ice")) score -= 3;
  if (s.includes("wind") && s.includes("strong")) score -= 1;
  if (temp >= 45 && temp <= 70) score += 1;
  if (temp < 32 || temp > 95) score -= 2;
  if (score >= 7) return { label: "Best", cls: "best" };
  if (score >= 5) return { label: "Good", cls: "good" };
  return { label: "Fair", cls: "fair" };
}

function estimateTempFromForecast(forecast, waterType) {
  const dayPeriods = (forecast || [])
    .filter((p) => p?.isDaytime && Number.isFinite(p?.temperature))
    .slice(0, 7);
  if (dayPeriods.length === 0) return null;

  const clamp = (n, lo, hi) => Math.max(lo, Math.min(hi, n));
  const estimated = dayPeriods.map((p) => {
    const air = p.temperature;
    const offset = waterType === "river"
      ? (air < 45 ? 10 : air < 60 ? 8 : 6)
      : (air < 45 ? 12 : air < 60 ? 10 : 8);
    const temp = clamp(air - offset, 34, 88);
    return { day: p.name, avg: +temp.toFixed(1) };
  });

  const first = estimated[0]?.avg;
  const second = estimated[1]?.avg;
  const last = estimated[estimated.length - 1]?.avg;
  return {
    temp: first,
    tempTrend24: Number.isFinite(second) ? +(second - first).toFixed(1) : null,
    tempTrend7: Number.isFinite(last) ? +(last - first).toFixed(1) : null,
    temps7: estimated,
    tempSource: "estimated",
    tempSourceLabel: "Estimated from NWS forecast",
    tempSourceNote: "No live water-temperature sensor available for this location; estimate uses forecast air-temperature trend.",
  };
}

// ─── API FUNCTIONS ──────────────────────────────────────────
async function fetchUSGS(siteId) {
  if (!siteId) {
    // No USGS gauge for this location
    return {
      temp: null, tempTrend24: null, tempTrend7: null, temps7: [],
      flow: null, flowTrend24: null, flowTrend7: null, flows7: [],
      gage: null, gageTrend24: null, gageTrend7: null, gages7: [],
      lastReading: null,
      tempSource: null,
      tempSourceLabel: null,
      tempSourceNote: null,
    };
  }
  const url = `https://waterservices.usgs.gov/nwis/iv/?format=json&sites=${siteId}&parameterCd=00010,00060,00065&period=P7D`;
  const resp = await fetch(url);
  if (!resp.ok) throw new Error("USGS API error");
  const data = await resp.json();
  const result = {
    temp: null, tempTrend24: null, tempTrend7: null, temps7: [],
    flow: null, flowTrend24: null, flowTrend7: null, flows7: [],
    gage: null, gageTrend24: null, gageTrend7: null, gages7: [],
    lastReading: null,
    tempSource: null,
    tempSourceLabel: null,
    tempSourceNote: null,
  };
  const series = data?.value?.timeSeries || [];
  // USGS returns water temp (00010) in Celsius — convert to Fahrenheit
  const cToF = (c) => +(c * 9 / 5 + 32).toFixed(1);
  for (const ts of series) {
    const code = ts.variable?.variableCode?.[0]?.value;
    const rawVals = ts.values?.[0]?.value || [];
    if (rawVals.length === 0) continue;
    if (code === "00010") {
      // Filter out equipment malfunction readings (-999999)
      const vals = rawVals.filter(v => parseFloat(v.value) > -99999);
      if (vals.length === 0) continue;
      const latest = vals[vals.length - 1];
      const latestC = parseFloat(latest.value);
      const latestF = cToF(latestC);
      const latestTime = new Date(latest.dateTime);
      result.temp = latestF;
      result.lastReading = latestTime;
      result.tempSource = "sensor";
      result.tempSourceLabel = "Live USGS sensor";
      result.tempSourceNote = "USGS parameter 00010 (water temperature).";
      // 24-hour trend (in °F)
      const t24 = new Date(latestTime - 24*60*60*1000);
      const v24 = vals.find(v => Math.abs(new Date(v.dateTime) - t24) < 2*60*60*1000);
      if (v24) result.tempTrend24 = +(latestF - cToF(parseFloat(v24.value))).toFixed(1);
      // 7-day trend (in °F)
      const t7 = new Date(latestTime - 7*24*60*60*1000);
      const v7 = vals.find(v => Math.abs(new Date(v.dateTime) - t7) < 4*60*60*1000);
      if (v7) result.tempTrend7 = +(latestF - cToF(parseFloat(v7.value))).toFixed(1);
      // Daily averages for 7-day chart (converted to °F)
      const days = {};
      for (const v of vals) {
        const d = new Date(v.dateTime);
        const key = `${d.getMonth()+1}/${d.getDate()}`;
        if (!days[key]) days[key] = { label: d.toLocaleDateString('en-US',{month:'short',day:'numeric'}), vals: [] };
        days[key].vals.push(cToF(parseFloat(v.value)));
      }
      result.temps7 = Object.values(days).slice(-7).map(d => ({
        day: d.label, avg: +(d.vals.reduce((a,b)=>a+b,0)/d.vals.length).toFixed(1)
      }));
    }
    if (code === "00060") {
      const vals = rawVals.filter(v => parseFloat(v.value) > -99999);
      if (vals.length === 0) continue;
      const latest = vals[vals.length - 1];
      const latestVal = parseFloat(latest.value);
      const latestTime = new Date(latest.dateTime);
      result.flow = Math.round(latestVal);
      if (!result.lastReading || latestTime > result.lastReading) result.lastReading = latestTime;
      const t24 = new Date(latestTime - 24*60*60*1000);
      const v24 = vals.find(v => Math.abs(new Date(v.dateTime) - t24) < 3*60*60*1000);
      if (v24) result.flowTrend24 = Math.round(latestVal - parseFloat(v24.value));
      const t7 = new Date(latestTime - 7*24*60*60*1000);
      const v7 = vals.find(v => Math.abs(new Date(v.dateTime) - t7) < 8*60*60*1000);
      if (v7) result.flowTrend7 = Math.round(latestVal - parseFloat(v7.value));
      const days = {};
      for (const v of vals) {
        const d = new Date(v.dateTime);
        const key = `${d.getMonth()+1}/${d.getDate()}`;
        if (!days[key]) days[key] = { label: d.toLocaleDateString('en-US',{month:'short',day:'numeric'}), vals: [] };
        days[key].vals.push(parseFloat(v.value));
      }
      result.flows7 = Object.values(days).slice(-7).map(d => ({
        day: d.label, avg: Math.round(d.vals.reduce((a,b)=>a+b,0)/d.vals.length)
      }));
    }
    if (code === "00065") {
      const vals = rawVals.filter(v => parseFloat(v.value) > -99999);
      if (vals.length === 0) continue;
      const latest = vals[vals.length - 1];
      const latestVal = parseFloat(latest.value);
      const latestTime = new Date(latest.dateTime);
      result.gage = +latestVal.toFixed(2);
      if (!result.lastReading || latestTime > result.lastReading) result.lastReading = latestTime;
      const t24 = new Date(latestTime - 24*60*60*1000);
      const v24 = vals.find(v => Math.abs(new Date(v.dateTime) - t24) < 3*60*60*1000);
      if (v24) result.gageTrend24 = +(latestVal - parseFloat(v24.value)).toFixed(2);
      const t7 = new Date(latestTime - 7*24*60*60*1000);
      const v7 = vals.find(v => Math.abs(new Date(v.dateTime) - t7) < 8*60*60*1000);
      if (v7) result.gageTrend7 = +(latestVal - parseFloat(v7.value)).toFixed(2);
      const days = {};
      for (const v of vals) {
        const d = new Date(v.dateTime);
        const key = `${d.getMonth()+1}/${d.getDate()}`;
        if (!days[key]) days[key] = { label: d.toLocaleDateString('en-US',{month:'short',day:'numeric'}), vals: [] };
        days[key].vals.push(parseFloat(v.value));
      }
      result.gages7 = Object.values(days).slice(-7).map(d => ({
        day: d.label, avg: +(d.vals.reduce((a,b)=>a+b,0)/d.vals.length).toFixed(2)
      }));
    }
  }
  return result;
}

let usaceSnapshotCache = null;
async function fetchUSACESnapshot(waterKey) {
  if (usaceSnapshotCache === null) {
    const resp = await fetch(`data/usace_levels.json?v=${Date.now()}`, { cache: "no-store" });
    if (!resp.ok) throw new Error("USACE snapshot unavailable");
    usaceSnapshotCache = await resp.json();
  }
  return usaceSnapshotCache?.waters?.[waterKey] || null;
}

async function fetchNWS(lat, lon) {
  const pts = await fetch(`https://api.weather.gov/points/${lat},${lon}`);
  if (!pts.ok) throw new Error("NWS points error");
  const ptsData = await pts.json();
  const fcUrl = ptsData.properties?.forecast;
  if (!fcUrl) throw new Error("No forecast URL");
  const fc = await fetch(fcUrl);
  if (!fc.ok) throw new Error("NWS forecast error");
  const fcData = await fc.json();
  return fcData.properties?.periods || [];
}

// ─── COMPONENTS ─────────────────────────────────────────────
function Loading() { return <div className="loading"><div className="spinner"></div>Loading live data...</div>; }
function ErrorMsg({ msg, onRetry }) {
  return <div className="error-msg">{msg}<br/><button className="retry-btn" onClick={onRetry}>Retry</button></div>;
}

function ShareSnapshot({ usgs, forecast, water, species }) {
  const [toast, setToast] = React.useState(false);
  const w = WATERS[water];
  const temp = usgs?.temp ?? null;
  const phase = getPhase(temp, species);
  const spawnTrigger = species === "cr" ? 60 : 50;
  const speciesName = species === "cr" ? "Crappie" : "White Bass";
  const tempIsEstimated = usgs?.tempSource === "estimated";
  const triggerDist = temp !== null ? Math.max(0, spawnTrigger - temp).toFixed(1) : null;
  const dayPeriods = (forecast || []).filter(p => p.isDaytime).slice(0, 3);
  const bestDay = dayPeriods.reduce((best, p) => {
    const s = rateFishing(p);
    return (!best || s.label === "Best") ? { day: p.name, temp: p.temperature, fc: p.shortForecast, rating: s.label } : best;
  }, null);

  const buildText = () => {
    const lines = [
      `\uD83D\uDC1F ${speciesName} Intel \u2022 ${w.name}`,
      `\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500`,
      temp !== null ? `\uD83C\uDF21 Water: ${temp.toFixed(1)}\u00B0F${tempIsEstimated ? " (estimated)" : ""} \u2022 ${phase.name}` : `\uD83C\uDF21 Temp unavailable`,
    ];
    if (usgs?.tempTrend24 !== null) {
      const t24 = `${usgs.tempTrend24 > 0 ? '+' : ''}${usgs.tempTrend24}\u00B0`;
      const t7 = usgs?.tempTrend7 !== null ? `${usgs.tempTrend7 > 0 ? '+' : ''}${usgs.tempTrend7}\u00B0` : 'n/a';
      lines.push(`\uD83D\uDCC8 24hr: ${t24} \u2022 7day: ${t7}`);
    }
    if (triggerDist > 0) lines.push(`\uD83C\uDFAF ${triggerDist}\u00B0F to ${species === "cr" ? "bed spawn" : "spawn trigger"}`);
    else if (temp >= spawnTrigger) lines.push(`\uD83D\uDD25 ${species === "cr" ? "Bed spawn" : "Spawn"} temps reached!`);
    if (bestDay) lines.push(`\u2B50 Best window: ${bestDay.day} (${bestDay.temp}\u00B0F, ${bestDay.fc})`);
    if (usgs?.flow) lines.push(`\uD83D\uDCA7 Flow: ${usgs.flow.toLocaleString()} cfs`);
    if (Number.isFinite(usgs?.gage)) lines.push(`\uD83D\uDCCF Lake level: ${usgs.gage.toFixed(2)} ft`);
    lines.push(`\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500`);
    lines.push(`sirgaladad.github.io/pocket-fishing-guide`);
    return lines.join('\n');
  };

  const share = async () => {
    const text = buildText();
    if (navigator.share) {
      try { await navigator.share({ text }); return; } catch {}
    }
    try { await navigator.clipboard.writeText(text); setToast(true); setTimeout(() => setToast(false), 2000); } catch {}
  };

  return <>
    <button className="share-btn" onClick={share}>{"\uD83D\uDCE4"} Share Fishing Report</button>
    {toast && <div className="share-toast">{"\u2705"} Copied to clipboard!</div>}
  </>;
}

/* ── Tackle Link Helpers ── */
const ytSearch = (q) => "https://www.youtube.com/results?search_query=" + encodeURIComponent(q + " fishing how to");
const walmartSearch = (q) => "https://www.walmart.com/search?q=" + encodeURIComponent(q + " fishing lure");

/* ── Feedback Widget ── */
function FeedbackWidget() {
  const [open, setOpen] = React.useState(false);
  const [rating, setRating] = React.useState(null);
  const [cat, setCat] = React.useState("");
  const [text, setText] = React.useState("");
  const [toast, setToast] = React.useState(false);

  const categories = ["Bug", "Feature Idea", "Fishing Tip", "General"];

  const buildBody = () => {
    const parts = [];
    if (rating !== null) parts.push(`**Rating:** ${rating === 1 ? "\uD83D\uDC4D Thumbs Up" : "\uD83D\uDC4E Thumbs Down"}`);
    if (cat) parts.push(`**Category:** ${cat}`);
    if (text) parts.push(`**Feedback:**\n${text}`);
    parts.push(`\n---\n_Sent from Pocket Fishing Guide v1.0_`);
    return parts.join("\n\n");
  };

  const submit = async () => {
    const body = buildBody();
    const issueUrl = "https://github.com/sirgaladad/pocket-fishing-guide/issues/new?"
      + "title=" + encodeURIComponent(`[Feedback] ${cat || "General"}: ${text.slice(0, 50) || "User feedback"}`)
      + "&body=" + encodeURIComponent(body)
      + "&labels=" + encodeURIComponent("user-feedback");
    window.open(issueUrl, "_blank");
    try { await navigator.clipboard.writeText(body); } catch {}
    setOpen(false); setRating(null); setCat(""); setText("");
    setToast(true); setTimeout(() => setToast(false), 3000);
  };

  return <>
    <button className="fb-fab" onClick={() => setOpen(!open)} title="Send Feedback">{"\uD83D\uDCEC"}</button>
    {open && <div className="fb-overlay" onClick={() => setOpen(false)}>
      <div className="fb-modal" onClick={e => e.stopPropagation()}>
        <h3 style={{margin:'0 0 4px',fontSize:16}}>Help Us Improve {"\uD83C\uDFA3"}</h3>
        <p style={{margin:'0 0 12px',fontSize:12,color:'var(--text3)'}}>Your feedback shapes the Pocket Fishing Guide</p>
        <div className="fb-rating">
          <button className={`fb-rating-btn ${rating === 1 ? 'active' : ''}`} onClick={() => setRating(1)}>{"\uD83D\uDC4D"}</button>
          <button className={`fb-rating-btn ${rating === 0 ? 'active' : ''}`} onClick={() => setRating(0)}>{"\uD83D\uDC4E"}</button>
        </div>
        <div className="fb-cats">
          {categories.map(c => <button key={c} className={`fb-cat ${cat === c ? 'active' : ''}`} onClick={() => setCat(c)}>{c}</button>)}
        </div>
        <textarea className="fb-text" placeholder="Tell us what's on your mind..." value={text} onChange={e => setText(e.target.value)} rows={3} />
        <div className="fb-actions">
          <button className="fb-submit" onClick={() => setOpen(false)} style={{background:'var(--bg3)',color:'var(--text2)'}}>Cancel</button>
          <button className="fb-submit" onClick={submit} disabled={rating === null && !text}>Send Feedback</button>
        </div>
      </div>
    </div>}
    {toast && <div className="fb-toast">{"\u2705"} Thanks for your feedback!</div>}
  </>;
}

function DashboardTab({ usgs, forecast, water, species, onRefresh, loading }) {
  if (loading) return <Loading />;
  const w = WATERS[water];
  const temp = usgs?.temp ?? null;
  const hasTemp = Number.isFinite(temp);
  const hasFlow = Number.isFinite(usgs?.flow);
  const hasGage = Number.isFinite(usgs?.gage);
  const phase = getPhase(temp, species);
  const phaseIdx = getPhaseIndex(temp, species);
  const phaseList = species === "cr" ? CR_PHASES : WB_PHASES;
  const spawnTrigger = species === "cr" ? 60 : 50;
  const scoutTemp = species === "cr" ? 55 : 45;
  const tempC = hasTemp ? ((temp - 32) * 5/9).toFixed(1) : null;
  const triggerDistValue = hasTemp ? Math.max(0, spawnTrigger - temp) : null;
  const triggerDist = hasTemp ? triggerDistValue.toFixed(1) : null;
  const daysEst = (Number.isFinite(usgs?.tempTrend7) && usgs.tempTrend7 > 0 && Number.isFinite(triggerDistValue) && triggerDistValue > 0)
    ? Math.ceil((triggerDistValue / usgs.tempTrend7) * 7) : null;

  const trendCls = (v) => v > 0 ? 'up' : v < 0 ? 'down' : 'flat';
  const trendArr = (v) => v > 0 ? '\u25B2' : v < 0 ? '\u25BC' : '\u2192';
  const fmtTrend = (v) => Number.isFinite(v) ? `${v > 0 ? '+' : ''}${v}\u00B0` : '';
  const fmtSigned = (v, suffix = '') => Number.isFinite(v) ? `${v > 0 ? '+' : ''}${v}${suffix}` : 'n/a';

  // Quick Glance verdict
  const dayPeriods0 = (forecast || []).filter(p => p.isDaytime).slice(0, 7);
  const bestWindowDay = dayPeriods0.reduce((best, p) => {
    const r = rateFishing(p);
    return (!best || r.label === "Best") ? { name: p.name, rating: r } : best;
  }, null);
  const verdict = !hasTemp ? { signal: 'wait', icon: '\u23F3', label: 'NO DATA', cls: 'wait' }
    : temp >= spawnTrigger ? { signal: 'go', icon: '\uD83D\uDD25', label: 'GO FISH!', cls: 'go' }
    : temp >= scoutTemp ? { signal: 'scout', icon: '\uD83D\uDC40', label: 'SCOUT', cls: 'scout' }
    : { signal: 'wait', icon: '\u2744\uFE0F', label: 'WAIT', cls: 'wait' };

  // Spawn bar
  const minT = 40, maxT = species === "cr" ? 75 : 70;
  const pct = hasTemp ? Math.min(100, Math.max(0, ((temp - minT) / (maxT - minT)) * 100)) : 0;
  const msPct = (t) => ((t - minT) / (maxT - minT)) * 100;

  const milestones = species === "cr" ? [
    { label: "Move", temp: 48, color: "#ab47bc" },
    { label: "Stage", temp: 55, color: "#e040fb" },
    { label: "Bed Spawn", temp: 60, color: "#f44336" }
  ] : [
    { label: "Staging", temp: 45, color: "#29b6f6" },
    { label: "Spawn", temp: 50, color: "#ff6b35" },
    { label: "Peak Run", temp: 55, color: "#f44336" }
  ];

  // Day forecasts for weather cards
  const dayPeriods = (forecast || []).filter(p => p.isDaytime).slice(0, 4);
  const sourceMeta = WATER_LEVEL_SOURCES[water] || { provider: "USGS/NWS", notes: "" };
  const sourceProvider = usgs?.levelProvider || sourceMeta.provider;
  const sourceUrl = usgs?.levelSourceUrl || sourceMeta.primaryUrl || null;
  const sourceStatus = usgs?.levelSourceStatus || null;
  const tempSourceLabel = usgs?.tempSourceLabel || "No temperature feed";
  const tempIsEstimated = usgs?.tempSource === "estimated";
  const gageTrend7 = usgs?.gageTrend7 ?? null;
  const flowTrend7 = usgs?.flowTrend7 ?? null;
  const gageStatus = !hasGage ? null
    : gageTrend7 === null ? { label: "Monitoring", cls: "good", note: "Need more history for trend direction." }
    : gageTrend7 > 1 ? { label: "Rising", cls: "best", note: "Water level rose significantly over the last 7 days." }
    : gageTrend7 < -1 ? { label: "Falling", cls: "note", note: "Water level dropped significantly over the last 7 days." }
    : { label: "Stable", cls: "good", note: "Water level has remained relatively stable week-over-week." };
  const flowStatus = !hasFlow ? null
    : w.type === "river"
      ? usgs.flow > 3000 ? { label: "High Flow", cls: "note", note: "Strong current. Favor protected seams and prioritize safety." }
      : usgs.flow < 300 ? { label: "Low Flow", cls: "note", note: "Low current can make fish wary. Downsize and fish deeper holes." }
      : { label: "Fishable Flow", cls: "best", note: "Current is generally fishable for active feeding windows." }
      : usgs.flow > 2000 ? { label: "Heavy Generation", cls: "note", note: "High release can reposition fish and increase current exposure." }
      : usgs.flow < 200 ? { label: "Minimal Generation", cls: "good", note: "Slack conditions. Focus on structure and bait concentrations." }
      : { label: "Moderate Generation", cls: "best", note: "Moderate flow often improves oxygen and feeding activity." };

  return <>
    <button className="refresh-btn" onClick={onRefresh}>{"\u21BB"} Refresh</button>
    <div style={{clear:'both',marginBottom:8}}></div>

    {/* QUICK GLANCE HERO */}
    {hasTemp && <div className="hero-card">
      <div className="hero-verdict">
        <div className={`hero-signal ${verdict.cls}`}>{verdict.icon}</div>
        <div className="hero-headline">
          {verdict.label === 'GO FISH!' ? <>{verdict.label} <span className="hero-hl">{species === "cr" ? "Crappie" : "White bass"} spawn temps reached!</span></>
            : verdict.label === 'SCOUT' ? <>SCOUT MODE <span className="hero-hl">{triggerDist}{"\u00B0"}F to {species === "cr" ? "bed spawn" : "spawn"} trigger</span></>
            : <>HOLD TIGHT <span className="hero-hl">Water still cold for {species === "cr" ? "crappie" : "white bass"}</span></>}
        </div>
      </div>
      <div className="hero-summary">
        {temp.toFixed(1)}{"\u00B0"}F water{tempIsEstimated ? " (estimated)" : ""}{Number.isFinite(usgs?.tempTrend24) ? `, ${usgs.tempTrend24 > 0 ? 'warming' : 'cooling'} ${Math.abs(usgs.tempTrend24)}\u00B0 in 24hr` : ''}
        {daysEst ? `. ~${daysEst} days to ${species === "cr" ? "bed spawn" : "spawn"} trigger at current rate.` : temp >= spawnTrigger ? '. Fish are moving!' : '.'}
        {bestWindowDay ? ` Best window: ${bestWindowDay.name}.` : ''}
      </div>
      <div className="hero-pills">
        <div className="hero-pill">{"\uD83C\uDF21\uFE0F"} <span className="pill-val">{temp.toFixed(1)}{"\u00B0"}F{tempIsEstimated ? "*" : ""}</span></div>
        {hasFlow && <div className="hero-pill">{"\uD83D\uDCA7"} <span className="pill-val">{usgs.flow.toLocaleString()}</span> cfs</div>}
        {hasGage && <div className="hero-pill">{"\uD83D\uDCCF"} <span className="pill-val">{usgs.gage.toFixed(2)}</span> ft</div>}
        <div className="hero-pill" style={{borderColor:phase.color+'44',color:phase.color}}>{phase.icon} <span className="pill-val">{phase.name}</span></div>
      </div>
    </div>}

    {/* DATA SOURCE STATUS */}
    <div className="card">
      <div className="card-title">{"\uD83D\uDD17"} Level & Flow Source</div>
      <div style={{fontSize:12,color:'var(--text2)',lineHeight:1.5}}>
        Provider: <span style={{color:'var(--text)',fontWeight:700}}>{sourceProvider}</span>
        {sourceStatus === "ok" && <span style={{color:'var(--green)',marginLeft:8,fontWeight:700}}>LIVE SNAPSHOT</span>}
        {sourceStatus === "error" && <span style={{color:'var(--orange)',marginLeft:8,fontWeight:700}}>SNAPSHOT ERROR</span>}
      </div>
      {sourceMeta.notes && <div style={{fontSize:11,color:'var(--text3)',marginTop:6,lineHeight:1.5}}>{sourceMeta.notes}</div>}
      {sourceUrl && <a href={sourceUrl} target="_blank" rel="noopener" style={{display:'inline-block',marginTop:8,fontSize:12,color:'var(--accent)',textDecoration:'underline'}}>
        Open source feed
      </a>}
    </div>

    {/* 2-COLUMN: WATER TEMP + SPAWN PHASE */}
    <div className="dash-grid">
      <div className="card">
        <div className="card-title">{"\uD83C\uDF0A"} Water Temperature <span className="temp-source-badge">{tempSourceLabel}</span></div>
        {hasTemp ? <>
          <div className="big-temp">{temp.toFixed(1)}<span className="unit">{"\u00B0"}F</span></div>
          <div className="temp-c">{tempC}{"\u00B0"}C</div>
          {usgs?.tempSourceNote && <div className="temp-source-note">{usgs.tempSourceNote}</div>}
          <div className="trend-row">
            {Number.isFinite(usgs?.tempTrend24) && <div className={`trend ${trendCls(usgs.tempTrend24)}`}>{trendArr(usgs.tempTrend24)} {fmtTrend(usgs.tempTrend24)} <span style={{fontWeight:400,fontSize:10}}>/24hr</span></div>}
            {Number.isFinite(usgs?.tempTrend7) && <div className={`trend ${trendCls(usgs.tempTrend7)}`}>{trendArr(usgs.tempTrend7)} {fmtTrend(usgs.tempTrend7)} <span style={{fontWeight:400,fontSize:10}}>/7day</span></div>}
          </div>
          <div className="gauge-meta">{w.usgs ? `USGS #${w.usgs}` : 'No USGS gauge'}{usgs.lastReading && <> {"\u00B7"} {usgs.lastReading.toISOString().slice(0,16).replace('T',' ')} CST</>}</div>
        </> : <div className="temp-empty">No water temperature is available yet for this location.
          <div className="temp-source-note">Try Refresh or switch lakes; level and flow data may still be available.</div>
          {hasFlow && <div className="flow-badge" style={{marginTop:6}}>{"\uD83D\uDCA7"} {usgs.flow.toLocaleString()} cfs</div>}
        </div>}
      </div>

      <div className="card">
        <div className="card-title">{"\uD83C\uDFA3"} Spawn Phase</div>
        <div className="phase-icon">{phase.icon}</div>
        <div className="phase-name" style={{color:phase.color}}>{phase.name}</div>
        <div className="phase-dots">
          {phaseList.map((_, i) => <div key={i} className={`phase-dot ${i <= phaseIdx ? 'active' : ''}`} style={i <= phaseIdx ? {background:phase.color} : {}}></div>)}
        </div>
        <div className="phase-desc">{phase.short?.substring(0, 60)}{phase.short?.length > 60 ? '...' : ''}</div>
        {triggerDist > 0 && <div className="phase-countdown"><span>{triggerDist}{"\u00B0"}F to {species === "cr" ? "bed spawn" : "spawn trigger"}</span>{daysEst && <> {"\u00B7"} ~{daysEst} days at current rate</>}</div>}
      </div>
    </div>

    {/* SPAWN TEMPERATURE TRACKER */}
    {hasTemp && <div className="card">
      <div className="card-title">{"\uD83D\uDCCA"} Spawn Temperature Tracker</div>
      <div className="spawn-labels">
        <span>{minT}{"\u00B0"}F</span>
        {species === "cr" ? <>
          <span>48{"\u00B0"} Move</span>
          <span>55{"\u00B0"} Stage</span>
          <span>60{"\u00B0"} Bed</span>
          <span>68{"\u00B0"}</span>
        </> : <>
          <span>45{"\u00B0"} Stage</span>
          <span>50{"\u00B0"} Spawn</span>
          <span>55{"\u00B0"} Peak</span>
          <span>60{"\u00B0"}</span>
        </>}
        <span>{maxT}{"\u00B0"}F</span>
      </div>
      <div className="spawn-bar">
        <div className="spawn-marker" style={{left: `${pct}%`}}></div>
      </div>
      <div className="spawn-milestones">
        {milestones.map((m, i) => <div className="spawn-ms" key={i}>
          <div className="spawn-ms-label" style={{color:m.color}}>{m.label}</div>
          <div className="spawn-ms-dist">{Math.max(0, m.temp - temp).toFixed(1)}{"\u00B0"}F away</div>
        </div>)}
      </div>
    </div>}

    {/* 7-DAY WATER TEMP TREND */}
    {usgs?.temps7?.length > 0 && <div className="card">
      <div className="card-title">{"\uD83D\uDCC8"} 7-Day Water Temperature Trend</div>
      <div className="temp-chart">
        {(() => {
          const avgs = usgs.temps7.map(x => x.avg);
          const maxT2 = Math.max(...avgs);
          const minT2 = Math.min(...avgs);
          const range = maxT2 - minT2;
          return usgs.temps7.map((t, i) => {
            // Scale: lowest bar = 15%, highest = 95%, linear between
            const pct = range < 0.1 ? 50 : 15 + ((t.avg - minT2) / range) * 80;
            const warmth = range < 0.1 ? 0.5 : (t.avg - minT2) / range;
            const isLast = i === usgs.temps7.length - 1;
            const color = isLast ? 'var(--spawn)' : `hsl(${200 - warmth * 140}, 65%, 55%)`;
            return <div className="temp-bar-wrap" key={i}>
              <div className="temp-bar-val" style={isLast ? {color:'var(--spawn)',fontWeight:700} : {}}>{t.avg}{"\u00B0"}</div>
              <div className="temp-bar-area">
                <div className="temp-bar" style={{height:`${pct}%`, background:color}}></div>
              </div>
              <div className="temp-bar-label">{t.day}</div>
            </div>;
          });
        })()}
      </div>
      {Number.isFinite(usgs?.tempTrend7) && <div className={`trend-analysis ${usgs.tempTrend7 < 0 ? 'cooling' : ''}`}>
        {usgs.tempTrend7 > 0 ? '\u25B2' : usgs.tempTrend7 < 0 ? '\u25BC' : '\u2192'} {usgs.tempTrend7 > 0 ? 'Warming' : usgs.tempTrend7 < 0 ? 'Cooling' : 'Stable'} trend: {fmtTrend(usgs.tempTrend7)} over 7 days. {usgs.tempTrend7 > 0 ? 'Water is moving toward spawn trigger temperature.' : usgs.tempTrend7 < 0 ? 'Water cooling \u2014 spawn activity may slow.' : 'Water temperature has been steady over the past week.'}
      </div>}
    </div>}

    {/* 7-DAY GAGE HEIGHT TREND */}
    <div className="card">
      <div className="card-title">{"\uD83D\uDCCF"} 7-Day Lake Level (Gage Height) Trend</div>
      {usgs?.gages7?.length > 0 ? <>
        <div className="temp-chart">
          {(() => {
            const avgs = usgs.gages7.map(x => x.avg);
            const maxG = Math.max(...avgs);
            const minG = Math.min(...avgs);
            const range = maxG - minG;
            return usgs.gages7.map((g, i) => {
              const pct = range < 0.05 ? 50 : 15 + ((g.avg - minG) / range) * 80;
              const isLast = i === usgs.gages7.length - 1;
              return <div className="temp-bar-wrap" key={i}>
                <div className="temp-bar-val" style={isLast ? {color:'var(--accent)',fontWeight:700} : {}}>{Number.isFinite(g.avg) ? `${g.avg.toFixed(2)} ft` : 'n/a'}</div>
                <div className="temp-bar-area">
                  <div className="temp-bar" style={{height:`${pct}%`, background:isLast ? 'var(--accent)' : '#5c9ed6'}}></div>
                </div>
                <div className="temp-bar-label">{g.day}</div>
              </div>;
            });
          })()}
        </div>
      {gageStatus && <div className={`fw-card ${gageStatus.cls}`} style={{marginTop:10}}>
        <div className="fw-card-title">{"\uD83E\uDDED"} Lake Level Status: {gageStatus.label}</div>
        <div className="fw-card-body">
            {Number.isFinite(usgs?.currentPowerPool)
              ? <>Current power pool: {usgs.currentPowerPool.toFixed(2)} ft. Top flood pool: {Number.isFinite(usgs?.topFloodPool) ? `${usgs.topFloodPool.toFixed(2)} ft` : 'n/a'}. {Number.isFinite(usgs?.feetBelowFloodPool) ? `${usgs.feetBelowFloodPool.toFixed(2)} ft below flood pool.` : ''} </>
              : <>Current level: {Number.isFinite(usgs?.gage) ? `${usgs.gage.toFixed(2)} ft.` : 'n/a'} </>}
            24hr {fmtSigned(usgs.gageTrend24, ' ft')}, 7day {fmtSigned(usgs.gageTrend7, ' ft')}. {gageStatus.note}
        </div>
      </div>}
      </> : <div className="fw-card note">
        <div className="fw-card-title">{"\u26A0"} Lake Level Status: Data Unavailable</div>
        <div className="fw-card-body">
          This USGS gauge currently has no gage-height time series for the selected period. Try another water body or check the USGS station page.
        </div>
      </div>}
    </div>

    {/* 7-DAY FLOW TREND */}
    <div className="card">
      <div className="card-title">{"\uD83D\uDCA7"} 7-Day Flow Trend</div>
      {usgs?.flows7?.length > 0 ? <>
        <div className="temp-chart">
          {(() => {
            const avgs = usgs.flows7.map(x => x.avg);
            const maxF = Math.max(...avgs);
            const minF = Math.min(...avgs);
            const range = maxF - minF;
            return usgs.flows7.map((f, i) => {
              const pct = range < 50 ? 50 : 15 + ((f.avg - minF) / range) * 80;
              const isLast = i === usgs.flows7.length - 1;
              return <div className="temp-bar-wrap" key={i}>
                <div className="temp-bar-val" style={isLast ? {color:'var(--green)',fontWeight:700} : {}}>{Number.isFinite(f.avg) ? f.avg.toLocaleString() : 'n/a'}</div>
                <div className="temp-bar-area">
                  <div className="temp-bar" style={{height:`${pct}%`, background:isLast ? 'var(--green)' : '#72b58a'}}></div>
                </div>
                <div className="temp-bar-label">{f.day}</div>
              </div>;
            });
          })()}
        </div>
        {flowStatus && <div className={`fw-card ${flowStatus.cls}`} style={{marginTop:10}}>
          <div className="fw-card-title">{"\uD83C\uDF0A"} Flow Meaning: {flowStatus.label}</div>
          <div className="fw-card-body">
            Current flow: {usgs.flow.toLocaleString()} cfs. 24hr {fmtSigned(usgs.flowTrend24, ' cfs')}, 7day {fmtSigned(usgs.flowTrend7, ' cfs')}. {flowStatus.note}
          </div>
        </div>}
      </> : <div className="fw-card note">
        <div className="fw-card-title">{"\u26A0"} Flow Meaning: Data Unavailable</div>
        <div className="fw-card-body">
          This USGS gauge currently has no flow time series for the selected period. Try another water body or check the USGS station page.
        </div>
      </div>}
    </div>

    {/* WEATHER OUTLOOK */}
    {dayPeriods.length > 0 && <div className="wx-cards">
      {dayPeriods.map((p, i) => <div className="wx-card" key={i}>
        <div className="day">{p.name}</div>
        <div className="icon">{getWxIcon(p.shortForecast)}</div>
        <div className="hi" style={{color:'var(--spawn)'}}>{p.temperature}{"\u00B0"}</div>
        <div className="wind">{p.windSpeed} {p.windDirection}</div>
        <div className="desc">{p.shortForecast}</div>
      </div>)}
    </div>}

    {/* SHARE SNAPSHOT */}
    <ShareSnapshot usgs={usgs} forecast={forecast} water={water} species={species} />
  </>;
}

function ForecastTab({ forecast, water }) {
  if (!forecast || forecast.length === 0) return <Loading />;
  const w = WATERS[water];
  const allPeriods = forecast.slice(0, 14);
  const dayPeriods = forecast.filter(p => p.isDaytime).slice(0, 7);

  return <>
    <div className="card">
      <div className="card-title">{"\u2600\uFE0F"} 7-Day Forecast {"\u2014"} {w.name} Area</div>
      {allPeriods.map((p, i) => <div className="fc-row" key={i}>
        <div className="fc-icon">{getWxIcon(p.shortForecast)}</div>
        <div className="fc-day">{p.name}</div>
        <div className="fc-temp">{p.temperature}{"\u00B0"}</div>
        <div className="fc-detail">
          <div className="fc-desc">{p.shortForecast}</div>
          {p.windSpeed && <div className="fc-wind">{p.windSpeed} {p.windDirection}</div>}
        </div>
        <div className="fc-daynight">{p.isDaytime ? "\u2705" : "\uD83C\uDF19"}</div>
      </div>)}
    </div>

    <div className="card">
      <div className="card-title">{"\uD83C\uDFAF"} Fishing Window Analysis</div>
      {dayPeriods.map((p, i) => {
        const rating = rateFishing(p);
        const s = (p.shortForecast || "").toLowerCase();
        let icon = "\uD83D\uDCDD", cls = "note";
        if (rating.cls === "best") { icon = "\u2B50"; cls = "best"; }
        else if (rating.cls === "good") { icon = "\uD83D\uDC4D"; cls = "good"; }

        const notes = [];
        if (s.includes("sunny")) notes.push("Sunny");
        else if (s.includes("cloudy")) notes.push("Cloudy");
        if (s.includes("rain")) notes.push("Rain expected");
        const windNote = p.windSpeed ? `, ${p.windSpeed} ${p.windDirection || ''}` : '';

        let advice = "";
        if (rating.cls === "best") advice = "Perfect conditions for scouting pre-spawn staging areas at creek mouths.";
        else if (s.includes("overcast") || s.includes("cloudy")) advice = "Overcast can be excellent for white bass \u2014 less spooky.";
        else if (s.includes("rain") && !s.includes("heavy")) advice = "Light rain can trigger feeding activity.";
        else if (s.includes("front") || (i > 0 && p.temperature < dayPeriods[i-1]?.temperature - 5)) advice = "Post-front conditions often produce excellent bites as barometric pressure stabilizes.";
        else advice = "Monitor conditions and adjust approach.";

        return <div className={`fw-card ${cls}`} key={i}>
          <div className="fw-card-title">{icon} {rating.cls === "best" ? "BEST WINDOW" : rating.cls === "good" ? "GOOD" : "NOTE"}: {p.name}</div>
          <div className="fw-card-body">{p.temperature}{"\u00B0"}F, {p.shortForecast}{windNote}. {advice}</div>
        </div>;
      })}
      <div className="fw-card tip">
        <div className="fw-card-title">{"\uD83D\uDCA1"} Pro Tip</div>
        <div className="fw-card-body">
          {dayPeriods[0]?.temperature > 60
            ? `Those warm days (${dayPeriods[0]?.temperature}\u00B0F air) will push water temp up \u2014 could break 45\u00B0F soon. Monitor closely.`
            : "Watch for warming trends in the forecast. Consecutive warm days push water temperature toward spawn triggers faster than a single warm day."}
        </div>
      </div>
    </div>
  </>;
}

function IntelTab({ temp, water, species }) {
  const phase = getPhase(temp, species);
  const lureMap = species === "cr" ? CR_LURES_BY_PHASE : LURES_BY_PHASE;
  const lures = lureMap[phase.name] || Object.values(lureMap)[1];
  const calendarData = species === "cr" ? CR_CALENDAR : WB_CALENDAR;
  const w = WATERS[water];
  const speciesName = species === "cr" ? "Crappie" : "White Bass";

  // WHERE/WHAT lookup by species
  const WB_WHERE = { "Winter Hold": "Deep channel bends, main lake points, 20-30ft depths. Fish the transitions between deep and shallow.",
    "Pre-Spawn Staging": "Creek mouths, river channel intersections, Hwy 10 bridge area. Fish the transitions between deep and shallow.",
    "Spawn Trigger": "Tributary entrances, creek arms, river channels moving upstream.",
    "Peak Spawn": "Tributaries, creek arms, and river channels. Follow the fish upstream.",
    "Post-Spawn": "Creek mouths, bridge pilings, mid-depth points and shoreline transitions.",
    "Summer Pattern": "Main lake humps, points, open water schools. Follow your electronics." };
  const CR_WHERE = { "Winter Deep": "Deep brush piles (15-25ft), standing timber, creek channel bends. Vertical presentations.",
    "Pre-Spawn Move": "Creek channel edges, mid-depth brush lines (8-12ft). Slow-roll presentations along structure.",
    "Spawn Staging": "Shallow stumps, laydowns, and visible brush at 3-8ft. Pitch to individual cover.",
    "Bed Spawn": "Bank cover, stumps, shallow brush (1-5ft). Sight-fish beds near visible structure.",
    "Post-Spawn": "Mid-depth brush and channel edges (8-15ft). Spider rigs and slow trolling.",
    "Summer Suspend": "Thermocline depth (18-25ft), deep brush, open water. Electronics are critical." };
  const WB_WHAT = { "Winter Hold": "Jigging spoons, blade baits, small jigs. Slow presentations near bottom.",
    "Pre-Spawn Staging": "1/16oz jighead + 2\" white curly tail grub. Small crankbaits (shad pattern). Slow retrieve.",
    "Spawn Trigger": "Cast upstream, retrieve with current. Inline spinners. Cover water at creek mouths.",
    "Peak Spawn": "Fast-moving baits. Rooster tails, inline spinners. Cover water quickly.",
    "Post-Spawn": "Reaction baits. Small crankbaits, topwater early. Faster retrieves.",
    "Summer Pattern": "Slab spoons (vertical), topwater at dawn/dusk, swimbaits through schools." };
  const CR_WHAT = { "Winter Deep": "1/16oz jig tipped with live minnow. Bobby Garland Baby Shad. Slow lift-drop near bottom.",
    "Pre-Spawn Move": "Road runner jigs (1/16oz). Live minnow under cork at 6-8ft. Slow troll channel edges.",
    "Spawn Staging": "1/32oz jig + tube (chartreuse/black flake). Pitch to stumps and laydowns. Light line.",
    "Bed Spawn": "1/32oz tube jig (white/chartreuse). Sight-fish beds. Slip cork + small jig for pressured fish.",
    "Post-Spawn": "Road runner 1/8oz. Small crankbaits (shad pattern). Spider rig brush lines.",
    "Summer Suspend": "Jigging spoon (1/8oz) at thermocline. Small swimbaits. Night fish with lights." };
  const whereNow = (species === "cr" ? CR_WHERE : WB_WHERE)[phase.name] || "Check electronics and target structure.";
  const whatThrow = (species === "cr" ? CR_WHAT : WB_WHAT)[phase.name] || "Match the hatch and adjust retrieve speed.";

  const currentMonth = new Date().getMonth();
  const isNow = (months) => {
    if (months.includes("Dec") && (currentMonth === 11 || currentMonth <= 1)) return true;
    if (months.includes("Feb") && months.includes("Mar") && (currentMonth >= 1 && currentMonth <= 2)) return true;
    if (months.includes("Mar") && months.includes("May") && (currentMonth >= 2 && currentMonth <= 4)) return true;
    if (months.includes("May") && months.includes("Jun") && (currentMonth >= 4 && currentMonth <= 5)) return true;
    if (months.includes("Jun") && months.includes("Sep") && (currentMonth >= 5 && currentMonth <= 8)) return true;
    if (months.includes("Oct") && months.includes("Nov") && (currentMonth >= 9 && currentMonth <= 10)) return true;
    return false;
  };

  const catColors = { Behavior: "#29b6f6", Timing: "#ff6b35", Access: "#4caf50", Safety: "#f44336", Structure: "#ffd54f", "Post-Spawn": "#66bb6a" };

  return <>
    {/* CURRENT PATTERN */}
    <div className="pattern-card">
      <div className="here-badge">YOU ARE HERE</div>
      <div className="pattern-name">{"\uD83C\uDF21\uFE0F"} Current Pattern: {phase.name}</div>
      <div className="pattern-desc">{phase.short}</div>
      <div className="pattern-cols">
        <div className="pattern-col">
          <div className="pattern-col-title">{"\uD83D\uDCCD"} Where to Fish Now</div>
          <p>{whereNow}</p>
        </div>
        <div className="pattern-col">
          <div className="pattern-col-title">{"\uD83C\uDFA3"} What to Throw</div>
          <p>{whatThrow}</p>
        </div>
      </div>
    </div>

    {/* 3-LURE ARSENAL */}
    <div className="card">
      <div className="card-title">{"\uD83C\uDFC6"} The 3-Lure Arsenal {species === "cr" ? "(Crappie)" : "(AGFC Chris Racey's Picks)"}</div>
      <div style={{fontSize:11,color:'var(--text3)',marginBottom:10}}>{species === "cr" ? `Top crappie setups for ${phase.name} pattern \u2014 ranked by effectiveness:` : `AGFC Deputy Director's personal white bass setup \u2014 this is all you need:`}</div>
      {lures.map((l, i) => <div className="lure-card" key={i}>
        <div className={`lure-num n${i+1}`}>{i + 1}</div>
        <div className="lure-info">
          <h4>{l.name}</h4>
          {l.sub && <div className="lure-sub">{l.sub}</div>}
          <p>{l.detail}</p>
          <div className="tackle-links">
            <a className="tackle-link yt" href={ytSearch(l.name)} target="_blank" rel="noopener">{"\u25B6"} How-To</a>
            <a className="tackle-link shop" href={walmartSearch(l.name)} target="_blank" rel="noopener">{"\uD83D\uDED2"} Shop</a>
          </div>
        </div>
      </div>)}
    </div>

    {/* ANNUAL CALENDAR */}
    <div className="card">
      <div className="card-title">{"\uD83D\uDCC5"} Annual {speciesName} Calendar</div>
      <div className="calendar">
        {calendarData.map((cp, i) => {
          const now = isNow(cp.months);
          return <div className={`cal-phase`} key={i} style={{borderLeftColor: now ? 'var(--accent)' : 'var(--bg4)'}}>
            <div className="cal-phase-head">
              <div className="cal-phase-name">{cp.icon} {cp.name}{now && <span className="cal-phase-now">NOW</span>}</div>
              <div className="cal-phase-time">{cp.months}</div>
            </div>
            <div className="cal-phase-desc">{cp.desc}</div>
            <div className="cal-phase-meta">{"\uD83D\uDCCD"} {cp.where} {"\u00B7"} {"\uD83C\uDFA3"} {cp.lures}</div>
          </div>;
        })}
      </div>
    </div>

    {/* PRO TIPS */}
    <div className="card">
      <div className="card-title">{"\uD83D\uDCA1"} {w.name} {speciesName} Pro Tips</div>
      {(species === "cr" && w.crTips ? w.crTips : w.tips).map((t, i) => <div style={{display:'flex',gap:10,alignItems:'flex-start',padding:'8px 0',borderBottom: i < (species === "cr" && w.crTips ? w.crTips : w.tips).length-1 ? '1px solid var(--bg3)' : 'none'}} key={i}>
        <span className="tip-cat-badge" style={{background:`${catColors[t.cat] || 'var(--accent)'}22`,color:catColors[t.cat] || 'var(--accent)',flexShrink:0,marginTop:2}}>{t.cat}</span>
        <span style={{fontSize:12,color:'var(--text2)',lineHeight:1.5}}>{t.text}</span>
      </div>)}
    </div>
  </>;
}

function AccessTab({ water }) {
  const w = WATERS[water];
  return <>
    {/* ALERT */}
    {w.alert && <div className="access-alert">{w.alert}</div>}

    {/* ACCESS POINTS */}
    <div className="card">
      <div className="card-title">{"\uD83D\uDCCD"} {w.name} Access Points</div>
      {w.access.map((a, i) => <div className="access-point" key={i}>
        <div className="access-header">
          <span style={{fontSize:18}}>{a.type === 'boat' ? '\uD83D\uDEA3' : '\uD83C\uDFDE\uFE0F'}</span>
          <span className="access-name">{a.name}</span>
          <span className={`access-badge ${a.type === 'boat' ? 'boat' : 'boat'}`}>{a.type === 'boat' ? '\uD83D\uDEA3 Boat' : '\uD83C\uDFDE\uFE0F Bank'}</span>
          <span className={`access-badge ${a.status}`}>{a.status === 'open' ? '\u2705 ' : a.status === 'limited' ? '\u26A0 ' : '\u274C '}{a.statusLabel}</span>
        </div>
        <div className="access-detail">{a.detail}</div>
        {(a.bestFor || a.restrictions) && <div className="access-cols">
          {a.bestFor && <div>
            <div className="access-col-title best">Best For:</div>
            <p>{a.bestFor}</p>
          </div>}
          {a.restrictions && <div>
            <div className="access-col-title restrict">Restrictions:</div>
            <p>{a.restrictions}</p>
          </div>}
        </div>}
      </div>)}
    </div>

    {/* REGULATIONS */}
    <div className="card">
      <div className="card-title">{"\u2696\uFE0F"} Key {w.name} Regulations</div>
      {w.regs.map((r, i) => <div className="reg-item" key={i}>{r}</div>)}
    </div>
  </>;
}

// ─── MAIN APP ───────────────────────────────────────────────
function App() {
  const [water, setWater] = useState(() => {
    try {
      const stored = localStorage.getItem('selectedWater');
      if (stored && WATERS[stored]) {
        return stored;
      }
      // Fallback to default and repair invalid or missing value
      try {
        localStorage.setItem('selectedWater', 'maumelle');
      } catch {
        // Ignore localStorage write errors (e.g., private browsing, quota exceeded)
      }
      return 'maumelle';
    } catch {
      return 'maumelle';
    }
  });
  const [tab, setTab] = useState("dashboard");
  const [species, setSpecies] = useState(() => {
    try {
      const stored = localStorage.getItem('selectedSpecies');
      if (stored === 'wb' || stored === 'cr') {
        return stored;
      }
      // Fallback to default and repair invalid or missing value
      try {
        localStorage.setItem('selectedSpecies', 'wb');
      } catch {
        // Ignore localStorage write errors (e.g., private browsing, quota exceeded)
      }
      return 'wb';
    } catch {
      return 'wb';
    }
  });
  const [usgs, setUsgs] = useState(null);
  const [forecast, setForecast] = useState(null);
  const [error, setError] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    try { localStorage.setItem('selectedWater', water); } catch {}
  }, [water]);

  useEffect(() => {
    try { localStorage.setItem('selectedSpecies', species); } catch {}
  }, [species]);

  const loadData = useCallback(async () => {
    setLoading(true);
    setError(null);
    setUsgs(null);
    setForecast(null);
    const w = WATERS[water];
    try {
      const [usgsData, nwsData, usaceData] = await Promise.allSettled([
        fetchUSGS(w.usgs),
        fetchNWS(w.lat, w.lon),
        fetchUSACESnapshot(water)
      ]);
      const merged = usgsData.status === "fulfilled"
        ? { ...usgsData.value }
        : {
            temp: null, tempTrend24: null, tempTrend7: null, temps7: [],
            flow: null, flowTrend24: null, flowTrend7: null, flows7: [],
            gage: null, gageTrend24: null, gageTrend7: null, gages7: [],
            lastReading: null,
            tempSource: null,
            tempSourceLabel: null,
            tempSourceNote: null,
          };

      if (usaceData.status === "fulfilled" && usaceData.value?.status === "ok") {
        const u = usaceData.value;
        if (u.currentPowerPool !== null) merged.gage = u.currentPowerPool;
        else if (u.gage !== null) merged.gage = u.gage;
        merged.topFloodPool = u.topFloodPool ?? null;
        merged.currentPowerPool = u.currentPowerPool ?? null;
        merged.feetBelowFloodPool = u.feetBelowFloodPool ?? null;
        if (u.gageTrend24 !== null) merged.gageTrend24 = u.gageTrend24;
        if (u.gageTrend7 !== null) merged.gageTrend7 = u.gageTrend7;
        if (Array.isArray(u.gages7) && u.gages7.length > 0) merged.gages7 = u.gages7;
        if (u.flow !== null) merged.flow = u.flow;
        if (u.flowTrend24 !== null) merged.flowTrend24 = u.flowTrend24;
        if (u.flowTrend7 !== null) merged.flowTrend7 = u.flowTrend7;
        if (Array.isArray(u.flows7) && u.flows7.length > 0) merged.flows7 = u.flows7;
        if (u.lastReading) merged.lastReading = new Date(u.lastReading);
        merged.levelProvider = u.provider || "USACE";
        merged.levelSourceUrl = u.sourceUrl || null;
        merged.levelSourceStatus = "ok";
      } else if (usaceData.status === "fulfilled" && usaceData.value?.status === "error") {
        merged.levelProvider = usaceData.value.provider || null;
        merged.levelSourceUrl = usaceData.value.sourceUrl || null;
        merged.levelSourceStatus = "error";
        merged.topFloodPool = null;
        merged.currentPowerPool = null;
        merged.feetBelowFloodPool = null;
      }

      if (!Number.isFinite(merged.temp) && nwsData.status === "fulfilled") {
        const est = estimateTempFromForecast(nwsData.value, w.type);
        if (est) {
          merged.temp = est.temp;
          merged.tempTrend24 = est.tempTrend24;
          merged.tempTrend7 = est.tempTrend7;
          merged.temps7 = est.temps7;
          merged.tempSource = est.tempSource;
          merged.tempSourceLabel = est.tempSourceLabel;
          merged.tempSourceNote = est.tempSourceNote;
        }
      }

      if (usgsData.status === "rejected") console.warn("USGS error:", usgsData.reason);
      if (usaceData.status === "rejected") console.warn("USACE snapshot error:", usaceData.reason);
      setUsgs(merged);

      if (nwsData.status === "fulfilled") setForecast(nwsData.value);
      else console.warn("NWS error:", nwsData.reason);
      if (usgsData.status === "rejected" && nwsData.status === "rejected" && usaceData.status === "rejected") {
        setError("Unable to load live data. Check your connection and try again.");
      }
    } catch (e) {
      setError("Failed to load data. Please try again.");
    }
    setLoading(false);
  }, [water]);

  useEffect(() => { loadData(); }, [loadData]);

  const temp = usgs?.temp ?? null;
  const phase = getPhase(temp, species);
  const w = WATERS[water];
  const spawnTrigger = species === "cr" ? 60 : 50;
  const triggerDist = temp !== null ? Math.max(0, spawnTrigger - temp).toFixed(1) : null;

  const tabs = [
    { id: "dashboard", icon: "\uD83D\uDCCA", label: "Dashboard" },
    { id: "forecast", icon: "\u2600\uFE0F", label: "Forecast" },
    { id: "intel", icon: "\uD83E\uDDE0", label: "Intel" },
    { id: "access", icon: "\uD83D\uDCCD", label: "Access" }
  ];

  const timestamp = usgs?.lastReading
    ? usgs.lastReading.toLocaleDateString('en-US', {month:'short',day:'numeric',year:'numeric'}) + ' \u00B7 ' + usgs.lastReading.toLocaleTimeString('en-US', {hour:'numeric',minute:'2-digit',timeZoneName:'short'})
    : null;

  const speciesLabel = species === "cr" ? "Crappie" : "White Bass";
  const speciesIcon = species === "cr" ? "\uD83D\uDC1F" : "\uD83D\uDC1F";

  return <>
    <div className="header">
      <div className="brand">Tale Waters & Tides</div>
      <h1>{speciesIcon} {speciesLabel} <span>Intelligence</span></h1>
      <div className="header-sub">{w.name}, AR {"\u00B7"} {w.usgs ? 'USGS Live Data' : 'Live Data'}</div>
      <div className="species-toggle">
        <button className={`species-btn ${species === "wb" ? "active-wb" : ""}`} onClick={() => setSpecies("wb")}>White Bass</button>
        <button className={`species-btn ${species === "cr" ? "active-cr" : ""}`} onClick={() => setSpecies("cr")}>Crappie</button>
      </div>
      {timestamp && <div className="header-meta">Data: {timestamp}<br/>{w.usgs ? `USGS #${w.usgs}` : 'No USGS gauge'} {"\u00B7"} NWS {w.nwsOffice}</div>}
      <div className="water-sel">
        {Object.entries(WATERS).map(([key, wd]) =>
          <button key={key} className={`water-btn ${water === key ? 'active' : ''}`} onClick={() => setWater(key)}>{wd.short}</button>
        )}
      </div>
    </div>

    <div className="tabs">
      {tabs.map(t => <div key={t.id} className={`tab ${tab === t.id ? 'active' : ''}`} onClick={() => setTab(t.id)}>
        <span className="tab-icon">{t.icon}</span>
        <span className="tab-label">{t.label}</span>
      </div>)}
    </div>

    <div className="content">
      {error && <ErrorMsg msg={error} onRetry={loadData} />}
      {tab === "dashboard" && <DashboardTab usgs={usgs} forecast={forecast} water={water} species={species} onRefresh={loadData} loading={loading} />}
      {tab === "forecast" && <ForecastTab forecast={forecast} water={water} />}
      {tab === "intel" && <IntelTab temp={temp} water={water} species={species} />}
      {tab === "access" && <AccessTab water={water} />}

      <div className="footer">
        Tale Waters & Tides, LLC {"\u00B7"} Data: {w.usgs ? `USGS #${w.usgs}` : 'No USGS gauge'} + NWS {w.nwsOffice}<br/>
        <em>Not a substitute for checking conditions. Fish responsibly.</em> {"\uD83C\uDFA3"}
        <div className="support-links">
          <a className="support-link kofi" href="https://ko-fi.com/coreytheideaguy" target="_blank" rel="noopener">{"\u2615"} Support on Ko-fi</a>
          <a className="support-link gh" href="https://github.com/sirgaladad/pocket-fishing-guide" target="_blank" rel="noopener">{"\u2B50"} Star on GitHub</a>
        </div>
      </div>
    </div>
    <FeedbackWidget />
  </>;
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
